{"title":"Node.jsä»¿çŸ¥ä¹æœåŠ¡ç«¯-æ·±å…¥ç†è§£RESTful API","date":"2020-06-29T00:00:00.000Z","date_formatted":{"ll":"Jun 29, 2020","L":"06/29/2020","MM-DD":"06-29"},"thumbnail":"https://blog-1251959181.cos.accelerate.myqcloud.com/cover/restful.jpg","link":"2020/06/28/imooc_354","comments":true,"tags":["Node.js","Note"],"categories":["Coding","imooc"],"updated":"2024-07-01T17:57:02.538Z","content":"<p><strong><a href=\"https://www.imooc.com/\" target=\"_blank\">æ…•è¯¾ç½‘</a>å®æˆ˜è¯¾ç¨‹ç¬”è®° â€”â€” <a href=\"https://coding.imooc.com/class/354.html\" target=\"_blank\">Node.jsä»¿çŸ¥ä¹æœåŠ¡ç«¯-æ·±å…¥ç†è§£RESTful API</a></strong></p>\n<h2 id=\"ç¬¬1ç« -å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„\">ç¬¬1ç«  å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„<a title=\"#ç¬¬1ç« -å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„\" href=\"#ç¬¬1ç« -å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„\"></a></h2>\n<blockquote>\n<p>è¿™ä¸€ç« åªæœ‰ä¸€èŠ‚ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯å‘Šè¯‰ä½ è¿™é—¨è¯¾ç¨‹è®²äº†ä»€ä¹ˆï¼Œæœ€ç»ˆåšå‡ºçš„æ•ˆæœï¼Œä»¥åŠå­¦ä¹ è¿™é—¨è¯¾ç¨‹ä½ éœ€è¦å…ˆæŒæ¡å“ªäº›æŠ€æœ¯ã€‚</p>\n</blockquote>\n<h3 id=\"1-1-å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†\">1-1 å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†<a title=\"#1-1-å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†\" href=\"#1-1-å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†\"></a></h3>\n<ul>\n<li>è¯¾ç¨‹ç›®æ ‡\n<ul>\n<li>ç†è§£RESTful APIçš„6ä¸ªé™åˆ¶å’Œè‹¥å¹²æœ€ä½³å®è·µ</li>\n<li>æŒæ¡Koa2ã€Postmanã€ MongoDBã€JWTç­‰æŠ€æœ¯</li>\n<li>è¿ç”¨ä¸Šè¿°æŠ€æœ¯æ­å»ºä»¿çŸ¥ä¹RESTful API</li>\n<li>æŒæ¡é˜¿é‡Œäº‘çº¿ä¸Šéƒ¨ç½²æ–¹æ³•</li>\n</ul>\n</li>\n<li>åŠŸèƒ½æŠ€æœ¯åˆ†æ\n<ul>\n<li>RESTful APIç†è®º</li>\n<li>Koa2</li>\n<li>Postman</li>\n<li>MongoDB</li>\n<li>JWT</li>\n<li>é˜¿é‡Œäº‘éƒ¨ç½²</li>\n</ul>\n</li>\n<li>å‰ç½®çŸ¥è¯†\n<ul>\n<li>Node.js åŸºç¡€</li>\n<li>ES6ã€ES7 åŸºç¡€</li>\n</ul>\n</li>\n<li>é‡éš¾ç‚¹åˆ†æ\n<ul>\n<li>RESTful APIç†è®º</li>\n<li>JWTè®¤è¯åŸç†</li>\n<li>å¤æ‚çš„æ•°æ®åº“å…³ç³»ï¼ˆä¸€å¯¹å¤šã€å¤šå¯¹å¤šç­‰ï¼‰</li>\n</ul>\n</li>\n<li>è¯¾ç¨‹å»ºè®®\n<ul>\n<li>ç†è®ºéƒ¨åˆ†åšåˆ°è‡ªé—®è‡ªç­”</li>\n<li>å®æˆ˜éƒ¨åˆ†åšåˆ°ä¸¾ä¸€åä¸‰</li>\n<li>ä¸æ­¢äºæœ¬è¯¾ç¨‹ï¼Œå­¦ä¹ æ›´å¤šæŠ€æœ¯</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ç¬¬2ç« -è·Ÿç€-github-è®¤è¯†-restful-api\">ç¬¬2ç«  è·Ÿç€ GitHub è®¤è¯† RESTful API<a title=\"#ç¬¬2ç« -è·Ÿç€-github-è®¤è¯†-restful-api\" href=\"#ç¬¬2ç« -è·Ÿç€-github-è®¤è¯†-restful-api\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä»¥å…¨çƒæœ€å¤§çš„åŒæ€§ç¤¾äº¤ç¤¾åŒº GitHub çš„ RESTful API åå‡ ä¸ªæœ€ä½³å®è·µä¸ºä¾‹ï¼Œè®©ä½ æŒæ¡æœ€å®Œæ•´çš„ RESTful API ç†è®º</p>\n</blockquote>\n<h3 id=\"2-1-rest-æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„-6-ä¸ªé™åˆ¶\">2-1 REST æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„ 6 ä¸ªé™åˆ¶<a title=\"#2-1-rest-æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„-6-ä¸ªé™åˆ¶\" href=\"#2-1-rest-æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„-6-ä¸ªé™åˆ¶\"></a></h3>\n<h4 id=\"restæ˜¯ä»€ä¹ˆï¼šä¸‡ç»´ç½‘è½¯ä»¶ç»“æ„é£æ ¼\">RESTæ˜¯ä»€ä¹ˆï¼šä¸‡ç»´ç½‘è½¯ä»¶ç»“æ„é£æ ¼<a title=\"#restæ˜¯ä»€ä¹ˆï¼šä¸‡ç»´ç½‘è½¯ä»¶ç»“æ„é£æ ¼\" href=\"#restæ˜¯ä»€ä¹ˆï¼šä¸‡ç»´ç½‘è½¯ä»¶ç»“æ„é£æ ¼\"></a></h4>\n<p>RESTï¼š<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer</p>\n<ul>\n<li>Representational: æ•°æ®çš„è¡¨ç°å½¢å¼(JSONã€XMâ€¦)</li>\n<li>State: å½“å‰çŠ¶æ€æˆ–è€…æ•°æ®</li>\n<li>Transfer: æ•°æ®ä¼ è¾“</li>\n</ul>\n<h4 id=\"restfulçš„6ä¸ªé™åˆ¶\">RESTfulçš„6ä¸ªé™åˆ¶<a title=\"#restfulçš„6ä¸ªé™åˆ¶\" href=\"#restfulçš„6ä¸ªé™åˆ¶\"></a></h4>\n<ol>\n<li>å®¢æˆ·ä¸€æœåŠ¡å™¨( Clientä¸€Server )\n<ul>\n<li>å…³æ³¨ç‚¹åˆ†ç¦»</li>\n<li>æœåŠ¡ç«¯ä¸“æ³¨æ•°æ®å­˜å‚¨,æå‡äº†ç®€å•æ€§</li>\n<li>å‰ç«¯ä¸“æ³¨ç”¨æˆ·ç•Œé¢,æå‡äº†å¯ç§»æ¤æ€§</li>\n</ul>\n</li>\n<li>æ— çŠ¶æ€( Stateless )\n<ul>\n<li>æ‰€æœ‰ç”¨æˆ·ä¼šè¯ä¿¡æ¯éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯</li>\n<li>æ¯æ¬¡è¯·æ±‚å¿…é¡»åŒ…æ‹¬æ‰€æœ‰ä¿¡æ¯,ä¸èƒ½ä¾èµ–ä¸Šä¸‹æ–‡ä¿¡æ¯</li>\n<li>æœåŠ¡ç«¯ä¸ç”¨ä¿å­˜ä¼šè¯ä¿¡æ¯,æå‡äº†ç®€å•æ€§ã€å¯é æ€§ã€å¯è§æ€§</li>\n</ul>\n</li>\n<li>ç¼“å­˜( Cache )\n<ul>\n<li>æ‰€æœ‰æœåŠ¡ç«¯å“åº”éƒ½è¦è¢«æ ‡ä¸ºå¯ç¼“å­˜æˆ–ä¸å¯ç¼“å­˜</li>\n<li>å‡å°‘å‰åç«¯äº¤äº’,æå‡äº†æ€§èƒ½</li>\n</ul>\n</li>\n<li>ç»Ÿä¸€æ¥å£( Uniform Interface )\n<ul>\n<li>æ¥å£è®¾è®¡å°½å¯èƒ½ç»Ÿä¸€é€šç”¨,æå‡äº†ç®€å•æ€§ã€å¯è§æ€§</li>\n<li>æ¥å£ä¸å®ç°è§£è€¦,ä½¿å‰åç«¯å¯ä»¥ç‹¬ç«‹å¼€å‘è¿­ä»£</li>\n</ul>\n</li>\n<li>åˆ†å±‚ç³»ç»Ÿ( Layered System )\n<ul>\n<li>æ¯å±‚åªçŸ¥é“ç›¸é‚»çš„ä¸€å±‚,åé¢éšè—çš„å°±ä¸çŸ¥é“äº†</li>\n<li>å®¢æˆ·ç«¯ä¸çŸ¥é“æ˜¯å’Œä»£ç†è¿˜æ˜¯çœŸå®æœåŠ¡å™¨é€šä¿¡</li>\n<li>å…¶ä»–å±‚:å®‰å…¨å±‚ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜å±‚ç­‰</li>\n</ul>\n</li>\n<li>æŒ‰éœ€ä»£ç ( Codeä¸€Onä¸€Demandå¯é€‰ )\n<ul>\n<li>å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½è¿è¡ŒæœåŠ¡ç«¯ä¼ æ¥çš„ä»£ç (æ¯”å¦‚JS)</li>\n<li>é€šè¿‡å‡å°‘ä¸€äº›åŠŸèƒ½,ç®€åŒ–äº†å®¢æˆ·ç«¯</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"2-2-ç»Ÿä¸€æ¥å£çš„é™åˆ¶\">2-2 ç»Ÿä¸€æ¥å£çš„é™åˆ¶<a title=\"#2-2-ç»Ÿä¸€æ¥å£çš„é™åˆ¶\" href=\"#2-2-ç»Ÿä¸€æ¥å£çš„é™åˆ¶\"></a></h3>\n<ul>\n<li>èµ„æºçš„æ ‡è¯†\n<ul>\n<li>èµ„æºæ˜¯ä»»ä½•å¯ä»¥å‘½åçš„äº‹ç‰©,æ¯”å¦‚ç”¨æˆ·ã€è¯„è®ºç­‰</li>\n<li>æ¯ä¸ªèµ„æºå¯ä»¥é€šè¿‡URIè¢«å”¯ä¸€åœ°æ ‡è¯†\n<ul>\n<li><a href=\"https://api.github.com/users\" target=\"_blank\">https://api.github.com/users</a></li>\n<li><a href=\"https://api.github.com/users/lewis617\" target=\"_blank\">https://api.github.com/users/lewis617</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>é€šè¿‡è¡¨è¿°æ¥æ“ä½œèµ„æº\n<ul>\n<li>è¡¨è¿°å°±æ˜¯Representationï¼Œæ¯”å¦‚JSONã€XMLç­‰</li>\n<li>å®¢æˆ·ç«¯ä¸èƒ½ç›´æ¥æ“ä½œ(æ¯”å¦‚SQL)æœåŠ¡ç«¯èµ„æº</li>\n<li>å®¢æˆ·ç«¯åº”è¯¥é€šè¿‡è¡¨è¿°(æ¯”å¦‚JSON)æ¥æ“ä½œèµ„æº</li>\n</ul>\n</li>\n<li>è‡ªæè¿°æ¶ˆæ¯\n<ul>\n<li>æ¯ä¸ªæ¶ˆæ¯ï¼ˆè¯·æ±‚æˆ–å“åº”ï¼‰å¿…é¡»æä¾›è¶³å¤Ÿçš„ä¿¡æ¯è®©æ¥å—è€…ç†è§£</li>\n<li>åª’ä½“ç±»å‹ï¼ˆapplication/jsonã€application/xmlï¼‰</li>\n<li>HTTPæ–¹æ³•ï¼šGETï¼ˆæŸ¥ï¼‰ã€POSTï¼ˆå¢ï¼‰ã€DELETEï¼ˆåˆ ï¼‰</li>\n<li>æ˜¯å¦ç¼“å­˜ï¼š Cache-Control</li>\n</ul>\n</li>\n<li>è¶…åª’ä½“ä½œä¸ºåº”ç”¨çŠ¶æ€å¼•æ“\n<ul>\n<li>è¶…åª’ä½“ï¼šå¸¦æ–‡å­—çš„é“¾æ¥</li>\n<li>åº”ç”¨çŠ¶æ€ï¼šä¸€ä¸ªç½‘é¡µ</li>\n<li>å¼•æ“ï¼šé©±åŠ¨ã€è·³è½¬</li>\n<li>åˆèµ·æ¥ï¼šç‚¹å‡»é“¾æ¥è·³è½¬åˆ°å¦ä¸€ä¸ªç½‘é¡µ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-3-restful-api-ç®€ä»‹\">2-3 RESTful API ç®€ä»‹<a title=\"#2-3-restful-api-ç®€ä»‹\" href=\"#2-3-restful-api-ç®€ä»‹\"></a></h3>\n<h4 id=\"restful-apiå…·ä½“ä»€ä¹ˆæ ·å­ï¼Ÿ\">RESTful APIå…·ä½“ä»€ä¹ˆæ ·å­ï¼Ÿ<a title=\"#restful-apiå…·ä½“ä»€ä¹ˆæ ·å­ï¼Ÿ\" href=\"#restful-apiå…·ä½“ä»€ä¹ˆæ ·å­ï¼Ÿ\"></a></h4>\n<ul>\n<li>åŸºæœ¬çš„URI ï¼Œå¦‚httpsï¼š<a href=\"//api.github.com/users\">//api.github.com/users</a></li>\n<li>æ ‡å‡†HTTPæ–¹æ³•ï¼Œå¦‚GETï¼Œ POSTï¼Œ PUTï¼Œ PATCHï¼Œ DELETE</li>\n<li>ä¼ è¾“çš„æ•°æ®åª’ä½“ç±»å‹ï¼Œå¦‚JSONï¼Œ XML</li>\n</ul>\n<h4 id=\"ç°å®ä¸¾ä¾‹\">ç°å®ä¸¾ä¾‹<a title=\"#ç°å®ä¸¾ä¾‹\" href=\"#ç°å®ä¸¾ä¾‹\"></a></h4>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">Methed</th>\n<th style=\"text-align:center\">URI</th>\n<th style=\"text-align:center\">Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">GET</td>\n<td style=\"text-align:center\">/users</td>\n<td style=\"text-align:center\">è·å–useråˆ—è¡¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">GET</td>\n<td style=\"text-align:center\">/users/1</td>\n<td style=\"text-align:center\">æŸ¥çœ‹user1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">POST</td>\n<td style=\"text-align:center\">/users</td>\n<td style=\"text-align:center\">æ–°å»ºä¸€ä¸ªuser</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">PUT</td>\n<td style=\"text-align:center\">/users/1</td>\n<td style=\"text-align:center\">æ›´æ–° user 1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">DELETE</td>\n<td style=\"text-align:center\">/users/1</td>\n<td style=\"text-align:center\">åˆ é™¤ user 1</td>\n</tr>\n</tbody>\n</table></div></div><h3 id=\"2-4-restful-api-è®¾è®¡æœ€ä½³å®è·µ\">2-4 RESTful API è®¾è®¡æœ€ä½³å®è·µ<a title=\"#2-4-restful-api-è®¾è®¡æœ€ä½³å®è·µ\" href=\"#2-4-restful-api-è®¾è®¡æœ€ä½³å®è·µ\"></a></h3>\n<ul>\n<li>è¯·æ±‚è®¾è®¡è§„èŒƒ\n<ul>\n<li>URIä½¿ç”¨åè¯ï¼Œå°½é‡ç”¨å¤æ•°ï¼Œå¦‚/users</li>\n<li>URIä½¿ç”¨åµŒå¥—è¡¨ç¤ºå…³è”å…³ç³»ï¼Œå¦‚/users/12/repos/5</li>\n<li>ä½¿ç”¨æ­£ç¡®çš„HTTPæ–¹æ³•ï¼Œå¦‚GET/POST/PUT/DELETE</li>\n<li>ä¸ç¬¦åˆCRUDçš„æƒ…å†µï¼šPOST/action/å­èµ„æº</li>\n</ul>\n</li>\n<li>ç›¸åº”è®¾è®¡è§„èŒƒ\n<ul>\n<li>æŸ¥è¯¢</li>\n<li>åˆ†é¡µ</li>\n<li>å­—æ®µè¿‡æ»¤</li>\n<li>çŠ¶æ€ç </li>\n<li>é”™è¯¯å¤„ç†</li>\n</ul>\n</li>\n<li>å®‰å…¨\n<ul>\n<li>HTTPS</li>\n<li>é‰´æƒ</li>\n<li>é™æµ</li>\n</ul>\n</li>\n<li>å¼€å‘è€…å‹å¥½\n<ul>\n<li>æ–‡æ¡£</li>\n<li>è¶…åª’ä½“</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ç¬¬3ç« -ç”¨-koa-è¯´-hello-world\">ç¬¬3ç«  ç”¨ Koa è¯´ Hello World<a title=\"#ç¬¬3ç« -ç”¨-koa-è¯´-hello-world\" href=\"#ç¬¬3ç« -ç”¨-koa-è¯´-hello-world\"></a></h2>\n<blockquote>\n<p>æœ¬ç« å°†å¸¦ä½ äº†è§£ä»€ä¹ˆæ˜¯ Koa æ¡†æ¶ï¼Œæ­å»º Koa æ¡†æ¶çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”ç¼–å†™ç¬¬ä¸€ä¸ª Koa æ¡†æ¶çš„ç¨‹åºã€‚ä¸ä»…å¦‚æ­¤ï¼Œé‡ç‚¹æ˜¯è¿˜è¦å¸¦ä½ ç†è§£ä»€ä¹ˆæ˜¯ Koa ä¸­é—´ä»¶ä»¥åŠç»å…¸çš„æ´‹è‘±æ¨¡å‹ã€‚</p>\n</blockquote>\n<h3 id=\"3-1-koa-ç®€ä»‹\">3-1 Koa ç®€ä»‹<a title=\"#3-1-koa-ç®€ä»‹\" href=\"#3-1-koa-ç®€ä»‹\"></a></h3>\n<h4 id=\"ä¸€å¥è¯ç®€ä»‹\">ä¸€å¥è¯ç®€ä»‹<a title=\"#ä¸€å¥è¯ç®€ä»‹\" href=\"#ä¸€å¥è¯ç®€ä»‹\"></a></h4>\n<blockquote>\n<p>åŸºäºNode.jsçš„ä¸‹ä¸€ä»£webå¼€å‘<strong>æ¡†æ¶</strong></p>\n</blockquote>\n<ul>\n<li>åŸºäºNode.jsï¼š Node.jsæ¨¡å—</li>\n<li>ä¸‹ä¸€ä»£ï¼šèš•é£Ÿç¬¬ä¸€ä»£Webæ¡†æ¶Expressçš„å¸‚åœº</li>\n<li>Webæ¡†æ¶ï¼šä¸æ˜¯å‘½ä»¤è¡Œå·¥å…·ã€ä¸æ˜¯ç®—æ³•</li>\n</ul>\n<h4 id=\"å®˜ç½‘ç®€ä»‹\">å®˜ç½‘ç®€ä»‹<a title=\"#å®˜ç½‘ç®€ä»‹\" href=\"#å®˜ç½‘ç®€ä»‹\"></a></h4>\n<blockquote>\n<p>Koaæ˜¯ä¸€ä¸ªæ–°çš„webæ¡†æ¶ï¼Œç”±Expresså¹•åçš„åŸç­äººé©¬æ‰“é€ ï¼Œè‡´åŠ›äºæˆä¸ºwebåº”ç”¨å’ŒAPIå¼€å‘é¢†åŸŸä¸­çš„ä¸€ä¸ªæ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„åŸºçŸ³ã€‚é€šè¿‡åˆ©ç”¨asyncå‡½æ•°ï¼Œ Koaå¸®ä½ ä¸¢å¼ƒå›è°ƒå‡½æ•°ï¼Œå¹¶æœ‰åŠ›åœ°å¢å¼ºé”™è¯¯å¤„ç†ã€‚Koaå¹¶æ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶ï¼Œè€Œæ˜¯æä¾›äº†ä¸€å¥—ä¼˜é›…çš„æ–¹æ³•ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè€Œæ„‰å¿«åœ°ç¼–å†™æœåŠ¡ç«¯åº”ç”¨ç¨‹åºã€‚</p>\n</blockquote>\n<ul>\n<li>ç”±Expresså¹•åçš„åŸç­äººé©¬æ‰“é€ </li>\n<li>Webåº”ç”¨å’ŒAPIå¼€å‘é¢†åŸŸ</li>\n<li>æ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®</li>\n<li>åˆ©ç”¨asyncå‡½æ•°ï¼Œä¸¢å¼ƒå›è°ƒå‡½æ•°</li>\n<li>å¢å¼ºé”™è¯¯å¤„ç†ï¼štry catch</li>\n<li>æ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶</li>\n<li>å¿«é€Ÿè€Œæ„‰å¿«åœ°ç¼–å†™ç¨‹åº</li>\n</ul>\n<h3 id=\"3-2-å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª-koa-ç¨‹åº\">3-2 å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª Koa ç¨‹åº<a title=\"#3-2-å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª-koa-ç¨‹åº\" href=\"#3-2-å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª-koa-ç¨‹åº\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆå§‹åŒ–é¡¹ç›®</li>\n<li>å®‰è£…Koa</li>\n<li>ç¼–å†™Hello World</li>\n<li>å­¦ä¹ è‡ªåŠ¨é‡å¯</li>\n</ul>\n</blockquote>\n<h4 id=\"åˆå§‹åŒ–é¡¹ç›®\">åˆå§‹åŒ–é¡¹ç›®<a title=\"#åˆå§‹åŒ–é¡¹ç›®\" href=\"#åˆå§‹åŒ–é¡¹ç›®\"></a></h4>\n<p>åœ¨åˆé€‚çš„ä½ç½®æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹</p>\n<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ<code>npm init</code></p>\n<h4 id=\"å®‰è£…koa\">å®‰è£…Koa<a title=\"#å®‰è£…koa\" href=\"#å®‰è£…koa\"></a></h4>\n<p><code>npm i koa --save</code></p>\n<p>æ–°å»ºJSæ–‡ä»¶ï¼Œæ¯”å¦‚<code>index.js</code></p>\n<h4 id=\"ç¼–å†™hello-world\">ç¼–å†™Hello World<a title=\"#ç¼–å†™hello-world\" href=\"#ç¼–å†™hello-world\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;Hello World&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"è‡ªåŠ¨é‡å¯\">è‡ªåŠ¨é‡å¯<a title=\"#è‡ªåŠ¨é‡å¯\" href=\"#è‡ªåŠ¨é‡å¯\"></a></h4>\n<p><code>npm i nodemon --save-dev</code></p>\n<p>ç”±äºæ˜¯æœ¬åœ°å®‰è£…æ‰€ä»¥å¹¶ä¸èƒ½åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ç›´æ¥æ‰§è¡Œ<code>nodemon index.js</code>ï¼Œæˆ‘ä»¬åœ¨<code>package.json</code>ä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight json\"><figcaption><span>package.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;start&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nodemon index.js&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-koa-ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹\">3-3 Koa ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹<a title=\"#3-3-koa-ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹\" href=\"#3-3-koa-ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å­¦ä¹  async await</li>\n<li>å­¦ä¹ ç¼–å†™Koaä¸­é—´ä»¶</li>\n<li>å­¦ä¹ æ´‹è‘±æ¨¡å‹</li>\n</ul>\n</blockquote>\n<h4 id=\"async-await\">async await<a title=\"#async-await\" href=\"#async-await\"></a></h4>\n<p>è·å–ä¸¤ä¸ªGitHubçš„æ¥å£å¹¶è¿”å›</p>\n<figure class=\"highlight js\"><figcaption><span>ä½¿ç”¨å›è°ƒå‡½æ•°</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;//api.github.com/users&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.<span class=\"title function_\">json</span>()).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">json</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(json);</span><br><span class=\"line\">    <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;//api.github.com/users/lewis617&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.<span class=\"title function_\">json</span>()).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">json2</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>. <span class=\"title function_\">log</span>(json2);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>ä½¿ç”¨async await</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;//api.github.com/users&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> json = <span class=\"keyword\">await</span> res.<span class=\"title function_\">json</span>();</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(json);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> res2 = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;//api.github.com/users/lewis617&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> json2 = <span class=\"keyword\">await</span> res2.<span class=\"title function_\">json</span>();</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(json2);</span><br><span class=\"line\">&#125;)()</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™koaä¸­é—´ä»¶\">ç¼–å†™Koaä¸­é—´ä»¶<a title=\"#ç¼–å†™koaä¸­é—´ä»¶\" href=\"#ç¼–å†™koaä¸­é—´ä»¶\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span> .<span class=\"title function_\">log</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">    <span class=\"variable language_\">console</span> <span class=\"title function_\">log</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;HeÃlo Zhihu API&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span> .<span class=\"title function_\">log</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">    <span class=\"variable language_\">console</span> <span class=\"title function_\">log</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span> .<span class=\"title function_\">log</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ´‹è‘±æ¨¡å‹\">æ´‹è‘±æ¨¡å‹<a title=\"#æ´‹è‘±æ¨¡å‹\" href=\"#æ´‹è‘±æ¨¡å‹\"></a></h4>\n<p>ä»¥ä¸Šä»£ç æ‰“å°çš„é¡ºåºä¸ºï¼š1 3 5 4 2ï¼Œç±»ä¼¼ä¸€ä¸ªğŸ§…</p>\n<!-- ![æ´‹è‘±æ¨¡å‹](#) -->\n<image src=\"https://blog-1251959181.cos.ap-beijing.myqcloud.com/posts/354/ycmx.png\" />\n<h2 id=\"ç¬¬4ç« -koa-æ¡†æ¶çš„è·¯ç”±ä¸-restful-api-æœ€ä½³å®è·µ\">ç¬¬4ç«  Koa æ¡†æ¶çš„è·¯ç”±ä¸ RESTful API æœ€ä½³å®è·µ<a title=\"#ç¬¬4ç« -koa-æ¡†æ¶çš„è·¯ç”±ä¸-restful-api-æœ€ä½³å®è·µ\" href=\"#ç¬¬4ç« -koa-æ¡†æ¶çš„è·¯ç”±ä¸-restful-api-æœ€ä½³å®è·µ\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£ Koa æ¡†æ¶çš„è·¯ç”±ã€‚å’Œå…¶ä»–è¯¾ç¨‹çš„åŒºåˆ«åœ¨äºï¼Œä¸ä»…è¦å­¦ä¹  Koa æ¡†æ¶æœ¬èº«çš„è·¯ç”±ç”¨æ³•ï¼Œè¿˜è¦å­¦ä¹ å®ç° REST é£æ ¼çš„è·¯ç”±ç”¨æ³•ã€‚</p>\n</blockquote>\n<h3 id=\"4-1-è·¯ç”±ç®€ä»‹\">4-1 è·¯ç”±ç®€ä»‹<a title=\"#4-1-è·¯ç”±ç®€ä»‹\" href=\"#4-1-è·¯ç”±ç®€ä»‹\"></a></h3>\n<h4 id=\"è·¯ç”±æ˜¯ä»€ä¹ˆï¼Ÿ\">è·¯ç”±æ˜¯ä»€ä¹ˆï¼Ÿ<a title=\"#è·¯ç”±æ˜¯ä»€ä¹ˆï¼Ÿ\" href=\"#è·¯ç”±æ˜¯ä»€ä¹ˆï¼Ÿ\"></a></h4>\n<ul>\n<li>å†³å®šäº†ä¸åŒURLæ˜¯å¦‚ä½•è¢«ä¸åŒåœ°æ‰§è¡Œçš„</li>\n<li>åœ¨Koaä¸­ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´ä»¶</li>\n</ul>\n<h4 id=\"ä¸ºä»€ä¹ˆè¦ç”¨è·¯ç”±ï¼Ÿ\">ä¸ºä»€ä¹ˆè¦ç”¨è·¯ç”±ï¼Ÿ<a title=\"#ä¸ºä»€ä¹ˆè¦ç”¨è·¯ç”±ï¼Ÿ\" href=\"#ä¸ºä»€ä¹ˆè¦ç”¨è·¯ç”±ï¼Ÿ\"></a></h4>\n<ul>\n<li>å¦‚æœæ²¡æœ‰è·¯ç”±ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</li>\n<li>è·¯ç”±å­˜åœ¨çš„æ„ä¹‰</li>\n</ul>\n<h4 id=\"å¦‚æœæ²¡æœ‰è·¯ç”±\">å¦‚æœæ²¡æœ‰è·¯ç”±<a title=\"#å¦‚æœæ²¡æœ‰è·¯ç”±\" href=\"#å¦‚æœæ²¡æœ‰è·¯ç”±\"></a></h4>\n<ul>\n<li>æ‰€æœ‰è¯·æ±‚éƒ½åšäº†ç›¸åŒçš„äº‹</li>\n<li>æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¿”å›ç›¸åŒçš„ç»“æœ</li>\n</ul>\n<h4 id=\"è·¯ç”±å­˜åœ¨çš„æ„ä¹‰\">è·¯ç”±å­˜åœ¨çš„æ„ä¹‰<a title=\"#è·¯ç”±å­˜åœ¨çš„æ„ä¹‰\" href=\"#è·¯ç”±å­˜åœ¨çš„æ„ä¹‰\"></a></h4>\n<ul>\n<li>å¤„ç†ä¸åŒçš„URL</li>\n<li>å¤„ç†ä¸åŒçš„HTTPæ–¹æ³•</li>\n<li>è§£æURLä¸Šçš„å‚æ•°</li>\n</ul>\n<h3 id=\"4-2-è‡ªå·±ç¼–å†™-koa-è·¯ç”±ä¸­é—´ä»¶\">4-2 è‡ªå·±ç¼–å†™ Koa è·¯ç”±ä¸­é—´ä»¶<a title=\"#4-2-è‡ªå·±ç¼–å†™-koa-è·¯ç”±ä¸­é—´ä»¶\" href=\"#4-2-è‡ªå·±ç¼–å†™-koa-è·¯ç”±ä¸­é—´ä»¶\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å¤„ç†ä¸åŒçš„URL</li>\n<li>å¤„ç†ä¸åŒçš„HTTPæ–¹æ³•</li>\n<li>è§£æURLä¸Šçš„å‚æ•°</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¤„ç†ä¸åŒçš„URL</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ctx.<span class=\"property\">url</span> === <span class=\"string\">&#x27;/&#x27;</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(ctx.<span class=\"property\">url</span> === <span class=\"string\">&#x27;/users&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¤„ç†ä¸åŒçš„HTTPæ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ctx.<span class=\"property\">method</span> === <span class=\"string\">&#x27;GET&#x27;</span>) &#123;</span><br><span class=\"line\">            ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ç”¨æˆ·åˆ—è¡¨é¡µ&#x27;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(ctx.<span class=\"property\">method</span> === <span class=\"string\">&#x27;POST&#x27;</span>) &#123;</span><br><span class=\"line\">            ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;åˆ›å»ºç”¨æˆ·&#x27;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ctx.<span class=\"property\">url</span>.<span class=\"title function_\">metch</span>(<span class=\"regexp\">/\\/users\\/\\w+/</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è§£æURLä¸Šçš„å‚æ•°</span></span><br><span class=\"line\">            <span class=\"keyword\">const</span> userId = ctx.<span class=\"property\">url</span>.<span class=\"title function_\">match</span>(<span class=\"regexp\">/\\/users\\/(\\w+)/</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">            ctx.<span class=\"property\">body</span> = <span class=\"string\">`è¿™æ˜¯ç”¨æˆ· <span class=\"subst\">$&#123;userId&#125;</span>`</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ctx.<span class=\"property\">status</span> = <span class=\"number\">405</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">status</span> = <span class=\"number\">404</span><span class=\"string\">&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">app.listen(3000);</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-ä½¿ç”¨-koa-router-å®ç°è·¯ç”±\">4-3 ä½¿ç”¨ koa-router å®ç°è·¯ç”±<a title=\"#4-3-ä½¿ç”¨-koa-router-å®ç°è·¯ç”±\" href=\"#4-3-ä½¿ç”¨-koa-router-å®ç°è·¯ç”±\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>æ›´ä¼˜é›…åœ°å®ç°è·¯ç”±åŸºæœ¬åŠŸèƒ½</li>\n<li>æ¼”ç¤ºä¸€äº›é«˜çº§è·¯ç”±åŠŸèƒ½ï¼Œå¦‚å‰ç¼€ã€å¤šä¸­é—´ä»¶</li>\n</ul>\n</blockquote>\n<h4 id=\"è·¯ç”±åŸºæœ¬åŠŸèƒ½\">è·¯ç”±åŸºæœ¬åŠŸèƒ½<a title=\"#è·¯ç”±åŸºæœ¬åŠŸèƒ½\" href=\"#è·¯ç”±åŸºæœ¬åŠŸèƒ½\"></a></h4>\n<p><code>npm i koa-router --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/users&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ç”¨æˆ·åˆ—è¡¨&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/users&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯åˆ›å»ºç”¨æˆ·æ¥å£&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/users/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">`è¿™æ˜¯ç”¨æˆ· <span class=\"subst\">$&#123;ctx.params.id&#125;</span>`</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>); </span><br></pre></td></tr></table></figure>\n<h4 id=\"é«˜çº§è·¯ç”±åŠŸèƒ½\">é«˜çº§è·¯ç”±åŠŸèƒ½<a title=\"#é«˜çº§è·¯ç”±åŠŸèƒ½\" href=\"#é«˜çº§è·¯ç”±åŠŸèƒ½\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"><span class=\"comment\">// è·¯ç”±å‰ç¼€</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> usersRouter = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/users&#x27;</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤šä¸­é—´ä»¶ æ¨¡æ‹Ÿé‰´æƒ</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">auth</span> = <span class=\"keyword\">async</span> (<span class=\"params\">ctx, next</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ctx.<span class=\"property\">url</span> !== <span class=\"string\">&#x27;/users&#x27;</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">401</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>(); </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, auth, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ç”¨æˆ·åˆ—è¡¨&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, auth, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯åˆ›å»ºç”¨æˆ·æ¥å£&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">`è¿™æ˜¯ç”¨æˆ· <span class=\"subst\">$&#123;ctx.params.id&#125;</span>`</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(usersRouter.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>); </span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-http-options-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ\">4-4 HTTP options æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ<a title=\"#4-4-http-options-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ\" href=\"#4-4-http-options-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ\"></a></h3>\n<h4 id=\"ä¸ºä½•è¦äº†è§£optionsæ–¹æ³•çš„ä½œç”¨ï¼Ÿ\">ä¸ºä½•è¦äº†è§£optionsæ–¹æ³•çš„ä½œç”¨ï¼Ÿ<a title=\"#ä¸ºä½•è¦äº†è§£optionsæ–¹æ³•çš„ä½œç”¨ï¼Ÿ\" href=\"#ä¸ºä½•è¦äº†è§£optionsæ–¹æ³•çš„ä½œç”¨ï¼Ÿ\"></a></h4>\n<ul>\n<li>è¿™æ˜¯ä¸€é“é¢è¯•é¢˜</li>\n<li>å¸®åŠ©ç†è§£koa-routerçš„allowedMethodsçš„ä½œç”¨</li>\n</ul>\n<h4 id=\"http-optionsæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\">HTTP optionsæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<a title=\"#http-optionsæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\" href=\"#http-optionsæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\"></a></h4>\n<ul>\n<li>æ£€æµ‹æœåŠ¡å™¨æ‰€æ”¯æŒçš„è¯·æ±‚æ–¹æ³•</li>\n<li>CORSä¸­çš„é¢„æ£€è¯·æ±‚</li>\n</ul>\n<h4 id=\"allowedmethodsçš„ä½œç”¨\">allowedMethodsçš„ä½œç”¨<a title=\"#allowedmethodsçš„ä½œç”¨\" href=\"#allowedmethodsçš„ä½œç”¨\"></a></h4>\n<ul>\n<li>å“åº”optionsæ–¹æ³•ï¼Œå‘Šè¯‰å®ƒæ‰€æ”¯æŒçš„è¯·æ±‚æ–¹æ³•</li>\n<li>ç›¸åº”åœ°è¿”å›405ï¼ˆä¸å…è®¸ï¼‰å’Œ501ï¼ˆæ²¡å®ç°ï¼‰</li>\n</ul>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(usersRouter.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(usersRouter.<span class=\"title function_\">allowedMethods</span>());</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-5-restful-api-æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”\">4-5 RESTful API æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”<a title=\"#4-5-restful-api-æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”\" href=\"#4-5-restful-api-æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°å¢åˆ æ”¹æŸ¥</li>\n<li>è¿”å›æ­£ç¡®çš„å“åº”</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> usersRouter = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/users&#x27;</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user1&#x27;</span> &#125;, &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user2&#x27;</span> &#125;];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;lilei&#x27;</span> &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">name</span>: <span class=\"string\">`<span class=\"subst\">$&#123;ctx.params.id&#125;</span>`</span> &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">name</span>: <span class=\"string\">`<span class=\"subst\">$&#123;ctx.params.id&#125;</span>`</span> &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// çŠ¶æ€ç 204è¡¨ç¤ºæˆåŠŸä½†æ²¡æœ‰è¿”å›</span></span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(usersRouter.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>); </span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬5ç« -koa-æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„\">ç¬¬5ç«  Koa æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„<a title=\"#ç¬¬5ç« -koa-æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„\" href=\"#ç¬¬5ç« -koa-æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£ Koa æ¡†æ¶çš„æ§åˆ¶å™¨éƒ¨åˆ†çš„å†…å®¹ã€‚ä»å¦‚ä½•è·å– HTTP çš„è¯·æ±‚å‚æ•°ï¼Œåˆ°å‘é€ HTTP çš„å“åº”ï¼Œä¸€åº”ä¿±å…¨ã€‚è®©ä½ æ˜ç™½ç›®å½•ç»“æ„æ˜¯æ€ä¹ˆæ¥è®¾è®¡çš„æ›´åˆç†ã€‚</p>\n</blockquote>\n<h3 id=\"5-1-æ§åˆ¶å™¨ç®€ä»‹\">5-1 æ§åˆ¶å™¨ç®€ä»‹<a title=\"#5-1-æ§åˆ¶å™¨ç®€ä»‹\" href=\"#5-1-æ§åˆ¶å™¨ç®€ä»‹\"></a></h3>\n<ul>\n<li>ä»€ä¹ˆæ˜¯æ§åˆ¶å™¨ï¼Ÿ\n<ul>\n<li>æ‹¿åˆ°è·¯ç”±åˆ†é…çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œ</li>\n<li>åœ¨Koaä¸­ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´ä»¶</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦ç”¨æ§åˆ¶å™¨ï¼Ÿ\n<ul>\n<li>è·å–HTTPè¯·æ±‚å‚æ•°</li>\n<li>å¤„ç†ä¸šåŠ¡é€»è¾‘</li>\n<li>å‘é€HTTPå“åº”</li>\n</ul>\n</li>\n<li>è·å–HTTPè¯·æ±‚å‚æ•°\n<ul>\n<li>Query String, å¦‚ <code>?q=keyword</code>, ä¸€èˆ¬ä¸ºå¯é€‰</li>\n<li>Router Params, å¦‚ <code>/users/:id</code>, ä¸€èˆ¬ä¸ºå¿…é€‰</li>\n<li>Body, å¦‚ <code>&#123; nameï¼š &quot;æé›·&quot; &#125;</code></li>\n<li>Header, å¦‚ <code>Accept</code>, <code>Cookie</code></li>\n</ul>\n</li>\n<li>å‘é€HTTPå“åº”\n<ul>\n<li>å‘é€Statusï¼Œå¦‚<code>200</code>/<code>400</code>ç­‰</li>\n<li>å‘é€Bodyï¼Œå¦‚<code>&#123; nameï¼š&quot;æé›·&quot; &#125;</code></li>\n<li>å‘é€Headerï¼Œå¦‚<code>Allow</code>ã€<code>Content-Type</code></li>\n</ul>\n</li>\n<li>ç¼–å†™æ§åˆ¶å™¨æœ€ä½³å®è·µ\n<ul>\n<li>æ¯ä¸ªèµ„æºçš„æ§åˆ¶å™¨æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶é‡Œ</li>\n<li>å°½é‡ä½¿ç”¨ ç±»+ç±»æ–¹æ³• çš„å½¢å¼ç¼–å†™æ§åˆ¶å™¨</li>\n<li>ä¸¥è°¨çš„é”™è¯¯å¤„ç†</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"5-2-è·å–-http-è¯·æ±‚å‚æ•°\">5-2 è·å– HTTP è¯·æ±‚å‚æ•°<a title=\"#5-2-è·å–-http-è¯·æ±‚å‚æ•°\" href=\"#5-2-è·å–-http-è¯·æ±‚å‚æ•°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å­¦ä¹ æ–­ç‚¹è°ƒè¯•</li>\n<li>è·å–query (ctx.query)</li>\n<li>è·å–router params (ctx.params)</li>\n<li>è·å–body (ctx.request.body)</li>\n<li>è·å–header (ctx.header)</li>\n</ul>\n</blockquote>\n<h4 id=\"æ–­ç‚¹è°ƒè¯•\">æ–­ç‚¹è°ƒè¯•<a title=\"#æ–­ç‚¹è°ƒè¯•\" href=\"#æ–­ç‚¹è°ƒè¯•\"></a></h4>\n<p>VSCodeä¸­æŒ‰F5è¿›å…¥è°ƒè¯•å¹¶è®¾ç½®æ–­ç‚¹</p>\n<h4 id=\"è·å–body\">è·å–body<a title=\"#è·å–body\" href=\"#è·å–body\"></a></h4>\n<p>koaä¸æ”¯æŒè§£æè¯·æ±‚ä½“ï¼Œéœ€è¦å¼•å…¥ä¸­é—´ä»¶<strong>koa-bodyparser</strong></p>\n<p><code>npm i koa-bodyparser --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>());</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-3-å‘é€-http-å“åº”\">5-3 å‘é€ HTTP å“åº”<a title=\"#5-3-å‘é€-http-å“åº”\" href=\"#5-3-å‘é€-http-å“åº”\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å‘é€ status</li>\n<li>å‘é€ body</li>\n<li>å‘é€ header</li>\n<li>å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥</li>\n</ul>\n</blockquote>\n<h4 id=\"å‘é€-status-&amp;-body\">å‘é€ status &amp; body<a title=\"#å‘é€-status-&amp;-body\" href=\"#å‘é€-status-&amp;-body\"></a></h4>\n<p><code>ctx.status = 204;</code></p>\n<p><code>ctx.body = '&lt;h1&gt;è¿™æ˜¯ä¸»é¡µ&lt;/h1&gt;';</code></p>\n<h4 id=\"å‘é€-header\">å‘é€ header<a title=\"#å‘é€-header\" href=\"#å‘é€-header\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;Allow&#x27;</span>, <span class=\"string\">&#x27;GET, POST&#x27;</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;lilei&#x27;</span> &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\">å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥<a title=\"#å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\" href=\"#å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> usersRouter = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/users&#x27;</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†…å­˜æ•°æ®åº“</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> db = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user1&#x27;</span> &#125;, &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user2&#x27;</span> &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>]; <span class=\"comment\">// å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>] = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">usersRouter.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db.<span class=\"title function_\">splice</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(usersRouter.<span class=\"title function_\">routes</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>); </span><br></pre></td></tr></table></figure>\n<h3 id=\"5-4-æ›´åˆç†çš„ç›®å½•ç»“æ„\">5-4 æ›´åˆç†çš„ç›®å½•ç»“æ„<a title=\"#5-4-æ›´åˆç†çš„ç›®å½•ç»“æ„\" href=\"#5-4-æ›´åˆç†çš„ç›®å½•ç»“æ„\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å°†è·¯ç”±å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç›®å½•</li>\n<li>å°†æ§åˆ¶å™¨å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç›®å½•</li>\n<li>ä½¿ç”¨ç±»+ç±»æ–¹æ³•çš„æ–¹å¼ç»„ç»‡æ§åˆ¶å™¨</li>\n</ul>\n</blockquote>\n<p>æ–°å»ºæ€»æ–‡ä»¶å¤¹<code>/app</code>ï¼Œå¹¶ä¿®æ”¹å…¥å£æ–‡ä»¶</p>\n<figure class=\"highlight json\"><figcaption><span>package.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;start&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nodemon app&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é‡æ„è·¯ç”±æ¨¡å—\">é‡æ„è·¯ç”±æ¨¡å—<a title=\"#é‡æ„è·¯ç”±æ¨¡å—\" href=\"#é‡æ„è·¯ç”±æ¨¡å—\"></a></h4>\n<p>æ–°å»ºè·¯ç”±æ–‡ä»¶å¤¹<code>/app/routes</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;è¿™æ˜¯ä¸»é¡µ&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/users&#x27;</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> db = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user1&#x27;</span> &#125;, &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user2&#x27;</span> &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>]; <span class=\"comment\">// å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>] = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, <span class=\"function\">(<span class=\"params\">ctx</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    db.<span class=\"title function_\">splice</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"function\">(<span class=\"params\">app</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    fs. <span class=\"title function_\">readdirSync</span>(__dirname ). <span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">file</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (file === <span class=\"string\">&#x27;index.js&#x27;</span>) &#123; <span class=\"keyword\">return</span>; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> route = <span class=\"built_in\">require</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;file&#125;</span>`</span>);</span><br><span class=\"line\">        app.<span class=\"title function_\">use</span>(route.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(route.<span class=\"title function_\">allowedMethods</span>());</span><br><span class=\"line\">    &#125;); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<h4 id=\"é‡æ„æ§åˆ¶å™¨æ¨¡å—\">é‡æ„æ§åˆ¶å™¨æ¨¡å—<a title=\"#é‡æ„æ§åˆ¶å™¨æ¨¡å—\" href=\"#é‡æ„æ§åˆ¶å™¨æ¨¡å—\"></a></h4>\n<p>æ–°å»ºæ§åˆ¶å™¨æ–‡ä»¶å¤¹<code>/app/controllers</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HomeCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">index</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;&lt;h1&gt;This is home page.&lt;/h1&gt;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">HomeCtl</span>();</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; index &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/home&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, index);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> db = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user1&#x27;</span> &#125;, &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;user2&#x27;</span> &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UsersCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = db;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        db.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">update</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>] = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">delete</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        db.<span class=\"title function_\">splice</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">UsersCtl</span>(); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/users&#x27;</span> &#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; find, findById, create, update, <span class=\"attr\">delete</span>: del &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, find);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, create);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, findById);</span><br><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, update);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, del);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬6ç« -å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶\">ç¬¬6ç«  å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶<a title=\"#ç¬¬6ç« -å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶\" href=\"#ç¬¬6ç« -å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£å¤šç§æ–¹æ¡ˆçš„é”™è¯¯å¤„ç†ã€‚ä¸»è¦åˆ†ä¸‰æ–¹é¢ï¼Œä¸€æ˜¯ Koa æ¡†æ¶è‡ªå¸¦çš„é”™è¯¯å¤„ç†ï¼Œä¸€æ˜¯ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼Œä¸€æ˜¯ä½¿ç”¨ä¼˜ç§€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶ã€‚</p>\n</blockquote>\n<h3 id=\"6-1-é”™è¯¯å¤„ç†ç®€ä»‹\">6-1 é”™è¯¯å¤„ç†ç®€ä»‹<a title=\"#6-1-é”™è¯¯å¤„ç†ç®€ä»‹\" href=\"#6-1-é”™è¯¯å¤„ç†ç®€ä»‹\"></a></h3>\n<ul>\n<li>ä»€ä¹ˆæ˜¯é”™è¯¯å¤„ç†ï¼Ÿ\n<ul>\n<li>ç¼–ç¨‹è¯­è¨€æˆ–è®¡ç®—æœºç¡¬ä»¶é‡Œçš„ä¸€ç§æœºåˆ¶</li>\n<li>å¤„ç†è½¯ä»¶æˆ–ä¿¡æ¯ç³»ç»Ÿä¸­å‡ºç°çš„å¼‚å¸¸çŠ¶å†µ</li>\n</ul>\n</li>\n<li>å¼‚å¸¸çŠ¶å†µæœ‰å“ªäº›ï¼Ÿ\n<ul>\n<li>è¿è¡Œæ—¶é”™è¯¯ï¼Œéƒ½è¿”å›500</li>\n<li>é€»è¾‘é”™è¯¯ï¼Œå¦‚æ‰¾ä¸åˆ°ï¼ˆ404ï¼‰ã€å…ˆå†³æ¡ä»¶å¤±è´¥ï¼ˆ412ï¼‰ã€æ— æ³•å¤„ç†çš„å®ä½“ï¼ˆå‚æ•°æ ¼å¼ä¸å¯¹ï¼Œ422ï¼‰ç­‰</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦ç”¨é”™è¯¯å¤„ç†ï¼Ÿ\n<ul>\n<li>é˜²æ­¢ç¨‹åºæŒ‚æ‰</li>\n<li>å‘Šè¯‰ç”¨æˆ·é”™è¯¯ä¿¡æ¯</li>\n<li>ä¾¿äºå¼€å‘è€…è°ƒè¯•</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"6-2-koa-è‡ªå¸¦çš„é”™è¯¯å¤„ç†\">6-2 Koa è‡ªå¸¦çš„é”™è¯¯å¤„ç†<a title=\"#6-2-koa-è‡ªå¸¦çš„é”™è¯¯å¤„ç†\" href=\"#6-2-koa-è‡ªå¸¦çš„é”™è¯¯å¤„ç†\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆ¶é€ 404ã€412ã€500ä¸‰ç§é”™è¯¯</li>\n<li>äº†è§£Koaè‡ªå¸¦çš„é”™è¯¯å¤„ç†åšäº†ä»€ä¹ˆ</li>\n</ul>\n</blockquote>\n<h4 id=\"404\">404<a title=\"#404\" href=\"#404\"></a></h4>\n<p>è¿™ä¸ªé”™è¯¯å¹¶ä¸æ˜¯ä»£ç é€ æˆçš„è€Œæ˜¯å®¢æˆ·ç«¯é€ æˆçš„ï¼Œè¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„URLå³å¯éªŒè¯</p>\n<h4 id=\"412\">412<a title=\"#412\" href=\"#412\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span> &gt;= db.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">412</span>, <span class=\"string\">&#x27;å…ˆå†³æ¡ä»¶å¤±è´¥: IDå¤§äºæ•°ç»„é•¿åº¦&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db[ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> * <span class=\"number\">1</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"500\">500<a title=\"#500\" href=\"#500\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    a.<span class=\"property\">b</span>;    <span class=\"comment\">// æ•…æ„å†™ä¸€æ®µé”™è¯¯ä»£ç </span></span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = db;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-3-è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶\">6-3 è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶<a title=\"#6-3-è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶\" href=\"#6-3-è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li>\n<li>åˆ¶é€ 404ã€412ã€500ä¸‰ç§é”™è¯¯æ¥æµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™ç§æ–¹æ³•å¹¶ä¸èƒ½æ•è·404æŠ¥é”™</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">status</span> = err.<span class=\"property\">status</span> || err.<span class=\"property\">statusCode</span> || <span class=\"number\">500</span>;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">message</span>: err.<span class=\"property\">message</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<h3 id=\"6-4-ä½¿ç”¨-koa-json-error-è¿›è¡Œé”™è¯¯å¤„ç†\">6-4 ä½¿ç”¨ koa-json-error è¿›è¡Œé”™è¯¯å¤„ç†<a title=\"#6-4-ä½¿ç”¨-koa-json-error-è¿›è¡Œé”™è¯¯å¤„ç†\" href=\"#6-4-ä½¿ç”¨-koa-json-error-è¿›è¡Œé”™è¯¯å¤„ç†\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£…koa-json-error</li>\n<li>ä½¿ç”¨koa-json-errorçš„é»˜è®¤é…ç½®å¤„ç†é”™è¯¯</li>\n<li>ä¿®æ”¹é…ç½®ä½¿å…¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ç¦ç”¨é”™è¯¯å †æ ˆçš„è¿”å›</li>\n</ul>\n</blockquote>\n<p><code>npm i koa-json-error --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-json-error&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// app.use(error());  é»˜è®¤è®¾ç½®ç›´æ¥è°ƒç”¨å‡½æ•°å³å¯</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">error</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">postFormat</span>: <span class=\"function\">(<span class=\"params\">e, &#123; stack, ...rest &#125;</span>) =&gt;</span> process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> === <span class=\"string\">&#x27;production&#x27;</span> ? rest : &#123; stack, ...rest &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><figcaption><span>package.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;start&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;NODE_ENV=production nodemon app&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nodemon app&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>winç”µè„‘ï¼š<br>\n<code>npm i cross-env --save-dev</code></p>\n<figure class=\"highlight json\"><figcaption><span>package.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;start&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cross-env NODE_ENV=production node app&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;dev&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nodemon app&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"6-5-ä½¿ç”¨-koa-parameter-æ ¡éªŒå‚æ•°\">6-5 ä½¿ç”¨ koa-parameter æ ¡éªŒå‚æ•°<a title=\"#6-5-ä½¿ç”¨-koa-parameter-æ ¡éªŒå‚æ•°\" href=\"#6-5-ä½¿ç”¨-koa-parameter-æ ¡éªŒå‚æ•°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£…koaä¸€parameter</li>\n<li>ä½¿ç”¨koaä¸€parameteræ ¡éªŒå‚æ•°</li>\n<li>åˆ¶é€ 422é”™è¯¯æ¥æµ‹è¯•æ ¡éªŒç»“æœ</li>\n</ul>\n</blockquote>\n<p><code>npm i koa-parameter --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-json-error&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> parameter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-parameter&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">error</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">postFormat</span>: <span class=\"function\">(<span class=\"params\">e, &#123; stack, ...rest &#125;</span>) =&gt;</span> process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> === <span class=\"string\">&#x27;production&#x27;</span> ? rest : &#123; stack , ...rest &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">parameter</span>(app));<span class=\"comment\">// ä¼ å…¥appï¼Œå¯ä»¥åœ¨ctxä¸­åŠ å…¥æ–¹æ³•ï¼Œå…¨å±€ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span> &#125;, <span class=\"comment\">// requiredé»˜è®¤ä¸ºtrue</span></span><br><span class=\"line\">        <span class=\"attr\">age</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;number&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    db.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬7ç« -ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~\">ç¬¬7ç«  ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~<a title=\"#ç¬¬7ç« -ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~\" href=\"#ç¬¬7ç« -ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£ NoSQL æ¦‚å¿µä»¥åŠ MongoDB æ•°æ®åº“çš„ç†è®ºä¸å…¥é—¨å®è·µã€‚é€šè¿‡ MongoDB Atlas äº‘æ•°æ®åº“å­¦ä¹  MongoDB çš„å¢åˆ æ”¹æŸ¥ç­‰å¸¸è§æ“ä½œã€‚</p>\n</blockquote>\n<h3 id=\"7-1-nosql-ç®€ä»‹\">7-1 NoSQL ç®€ä»‹<a title=\"#7-1-nosql-ç®€ä»‹\" href=\"#7-1-nosql-ç®€ä»‹\"></a></h3>\n<ul>\n<li>ä»€ä¹ˆæ˜¯NoSQL\n<ul>\n<li>å¯¹ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°</li>\n</ul>\n</li>\n<li>NoSQLæ•°æ®åº“çš„åˆ†ç±»\n<ul>\n<li>åˆ—å­˜å‚¨ï¼ˆHBaseï¼‰</li>\n<li>æ–‡æ¡£å­˜å‚¨ï¼ˆMongoDBï¼‰</li>\n<li>Key-valueå­˜å‚¨ï¼ˆRedisï¼‰</li>\n<li>å›¾å­˜å‚¨ï¼ˆFlockDBï¼‰</li>\n<li>å¯¹è±¡å­˜å‚¨ï¼ˆdb4oï¼‰</li>\n<li>XMLå­˜å‚¨ï¼ˆBaseXï¼‰</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦ç”¨NoSQL\n<ul>\n<li>ç®€å•ï¼ˆæ²¡æœ‰åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ç­‰å¤æ‚è§„èŒƒï¼‰</li>\n<li>ä¾¿äºæ¨ªå‘æ‹“å±•</li>\n<li>é€‚åˆè¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨</li>\n<li>å¾ˆçµæ´»åœ°å­˜å‚¨å¤æ‚ç»“æ„çš„æ•°æ®ï¼ˆSchema Freeï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"7-2-mongodb-ç®€ä»‹\">7-2 MongoDB ç®€ä»‹<a title=\"#7-2-mongodb-ç®€ä»‹\" href=\"#7-2-mongodb-ç®€ä»‹\"></a></h3>\n<ul>\n<li>ä»€ä¹ˆæ˜¯MongoDB ï¼Ÿ\n<ul>\n<li>æ¥è‡ªäºè‹±æ–‡å•è¯&quot;Humongousâ€ï¼Œ ä¸­æ–‡å«ä¹‰ä¸º&quot;åºå¤§â€</li>\n<li>é¢å‘æ–‡æ¡£å­˜å‚¨çš„å¼€æºæ•°æ®åº“</li>\n<li>ç”±C++ç¼–å†™è€Œæˆ</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦ç”¨MongoDB ï¼Ÿ\n<ul>\n<li>æ€§èƒ½å¥½ï¼ˆå†…å­˜è®¡ç®—ï¼‰</li>\n<li>å¤§è§„æ¨¡æ•°æ®å­˜å‚¨ï¼ˆå¯æ‹“å±•æ€§ï¼‰</li>\n<li>å¯é å®‰å…¨ï¼ˆæœ¬åœ°å¤åˆ¶ã€è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼‰</li>\n<li>æ–¹ä¾¿å­˜å‚¨å¤æ‚æ•°æ®ç»“æ„ï¼ˆSchema Freeï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"7-3-äº‘æ•°æ®åº“â€”â€”mongodb-atlas\">7-3 äº‘æ•°æ®åº“â€”â€”MongoDB Atlas<a title=\"#7-3-äº‘æ•°æ®åº“â€”â€”mongodb-atlas\" href=\"#7-3-äº‘æ•°æ®åº“â€”â€”mongodb-atlas\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>æ³¨å†Œç”¨æˆ·</li>\n<li>åˆ›å»ºé›†ç¾¤</li>\n<li>æ·»åŠ æ•°æ®åº“ç”¨æˆ·</li>\n<li>è®¾ç½®IPåœ°å€ç™½åå•</li>\n<li>è·å–è¿æ¥åœ°å€</li>\n</ul>\n</blockquote>\n<p><a href=\"https://stackoverflow.com/questions/50362647/connecting-to-mongodb-atlas-from-firebase-functions/58822693#58822693?newreg=a3af857c5c944c34a5f48ff365b97c0e\" target=\"_blank\">https://stackoverflow.com/questions/50362647/connecting-to-mongodb-atlas-from-firebase-functions/58822693#58822693?newreg=a3af857c5c944c34a5f48ff365b97c0e</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error: querySrv ESERVFAIL _mongodb._tcp.vincentebase.yqjup.mongodb.net</span><br><span class=\"line\">    at QueryReqWrap.onresolve [as oncomplete] (dns.js:203:19) &#123;</span><br><span class=\"line\">  errno: &#x27;ESERVFAIL&#x27;,</span><br><span class=\"line\">  code: &#x27;ESERVFAIL&#x27;,</span><br><span class=\"line\">  syscall: &#x27;querySrv&#x27;,</span><br><span class=\"line\">  hostname: &#x27;_mongodb._tcp.vincentebase.yqjup.mongodb.net&#x27;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Error: queryTxt ESERVFAIL vincentebase.yqjup.mongodb.net</span><br><span class=\"line\">    at QueryReqWrap.onresolve [as oncomplete] (dns.js:203:19) &#123;</span><br><span class=\"line\">  errno: &#x27;ESERVFAIL&#x27;,</span><br><span class=\"line\">  code: &#x27;ESERVFAIL&#x27;,</span><br><span class=\"line\">  syscall: &#x27;queryTxt&#x27;,</span><br><span class=\"line\">  hostname: &#x27;vincentebase.yqjup.mongodb.net&#x27;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿æ¥æ—¶éœ€è¦ä¿®æ”¹å¯†ç å’Œæ•°æ®åº“å</p>\n<h3 id=\"7-4-ä½¿ç”¨-mongoose-è¿æ¥-mongodb\">7-4 ä½¿ç”¨ Mongoose è¿æ¥ MongoDB<a title=\"#7-4-ä½¿ç”¨-mongoose-è¿æ¥-mongodb\" href=\"#7-4-ä½¿ç”¨-mongoose-è¿æ¥-mongodb\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£… Mong oose</li>\n<li>ç”¨ Mongoose è¿æ¥ MongoDB</li>\n</ul>\n</blockquote>\n<p><code>npm i mongoose --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/config.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">connectionStr</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyparser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-json-error&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> parameter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-parameter&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; connectionStr &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(connectionStr, &#123; <span class=\"attr\">useNewUrlParser</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;MongoDB è¿æ¥æˆåŠŸ&#x27;</span>));</span><br><span class=\"line\">mongoose.<span class=\"property\">connection</span>.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"variable language_\">console</span>.<span class=\"property\">error</span>); <span class=\"comment\">// å¦‚æœè¿æ¥å‡ºé”™ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">error</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">postFormat</span>: <span class=\"function\">(<span class=\"params\">e, &#123; stack, ...rest &#125;</span>) =&gt;</span> process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> === <span class=\"string\">&#x27;production&#x27;</span> ? rest : &#123; stack , ...rest &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyparser</span>());</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">parameter</span>(app));<span class=\"comment\">// ä¼ å…¥appï¼Œå¯ä»¥åœ¨ctxä¸­åŠ å…¥æ–¹æ³•ï¼Œå…¨å±€ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<h3 id=\"7-5-è®¾è®¡ç”¨æˆ·æ¨¡å—çš„-schema\">7-5 è®¾è®¡ç”¨æˆ·æ¨¡å—çš„ Schema<a title=\"#7-5-è®¾è®¡ç”¨æˆ·æ¨¡å—çš„-schema\" href=\"#7-5-è®¾è®¡ç”¨æˆ·æ¨¡å—çš„-schema\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆ†æç”¨æˆ·æ¨¡å—çš„å±æ€§</li>\n<li>ç¼–å†™ç”¨æˆ·æ¨¡å—çš„Schema</li>\n<li>ä½¿ç”¨Schemaç”Ÿæˆç”¨æˆ·Model</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-6-ç”¨-mongodb-å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\">7-6 ç”¨ MongoDB å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥<a title=\"#7-6-ç”¨-mongodb-å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\" href=\"#7-6-ç”¨-mongodb-å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>ç”¨Mongooseå®ç°å¢åˆ æ”¹æŸ¥æ¥å£</li>\n<li>ç”¨Postmanæµ‹è¯•å¢åˆ æ”¹æŸ¥æ¥å£</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">User</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../models/users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UsersCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">find</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>).<span class=\"title function_\">save</span>();</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">update</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findByIdAndUpdate</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>, ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">delete</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findByIdAndRemove</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">        ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">UsersCtl</span>();</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬8ç« -jwt-åœ¨-koa-æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ\">ç¬¬8ç«  JWT åœ¨ Koa æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ<a title=\"#ç¬¬8ç« -jwt-åœ¨-koa-æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ\" href=\"#ç¬¬8ç« -jwt-åœ¨-koa-æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£ JWT å¦‚ä½•å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒã€‚ä» Session å¼€å§‹è®²è§£è¿‡æ¸¡åˆ° JWTï¼Œå…³é”®åœ¨äº Session å’Œ JWT çš„å¯¹æ¯”ã€‚ä»¥åŠé€šè¿‡ Koa æ¡†æ¶çš„ JWT ä¸­é—´ä»¶å®ç°ç”¨æˆ·æ³¨å†Œäºæˆæƒç™»å½•åŠŸèƒ½ã€‚</p>\n</blockquote>\n<h3 id=\"8-1-session-ç®€ä»‹\">8-1 Session ç®€ä»‹<a title=\"#8-1-session-ç®€ä»‹\" href=\"#8-1-session-ç®€ä»‹\"></a></h3>\n<ul>\n<li>Sessionçš„ä¼˜åŠ¿\n<ul>\n<li>ç›¸æ¯”JWTï¼Œæœ€å¤§çš„ä¼˜åŠ¿å°±åœ¨äºå¯ä»¥ä¸»åŠ¨æ¸…é™¤sessionäº†</li>\n<li>sessionä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œç›¸å¯¹è¾ƒä¸ºå®‰å…¨</li>\n<li>ç»“åˆcookieä½¿ç”¨ï¼Œè¾ƒä¸ºçµæ´»ï¼Œå…¼å®¹æ€§è¾ƒå¥½</li>\n</ul>\n</li>\n<li>Sessionçš„åŠ£åŠ¿\n<ul>\n<li>cookie + sessionåœ¨è·¨åŸŸåœºæ™¯è¡¨ç°å¹¶ä¸å¥½</li>\n<li>å¦‚æœæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œéœ€è¦åšå¤šæœºå…±äº«sessionæœºåˆ¶</li>\n<li>åŸºäºcookieçš„æœºåˆ¶å¾ˆå®¹æ˜“è¢«CSRF</li>\n<li>æŸ¥è¯¢sessionä¿¡æ¯å¯èƒ½ä¼šæœ‰æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</li>\n</ul>\n</li>\n<li>Sessionç›¸å…³çš„æ¦‚å¿µä»‹ç»\n<ul>\n<li>session: ä¸»è¦å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œç›¸å¯¹å®‰å…¨</li>\n<li>cookie: ä¸»è¦å­˜æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”ä¸æ˜¯å¾ˆå®‰å…¨</li>\n<li>sessionStorage: ä»…åœ¨å½“å‰ä¼šè¯ä¸‹æœ‰æ•ˆï¼Œå…³é—­é¡µé¢æˆ–æµè§ˆå™¨åè¢«æ¸…é™¤</li>\n<li>localstorage: é™¤éè¢«æ¸…é™¤ï¼Œå¦åˆ™æ°¸ä¹…ä¿å­˜</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"8-2-jwt-ç®€ä»‹\">8-2 JWT ç®€ä»‹<a title=\"#8-2-jwt-ç®€ä»‹\" href=\"#8-2-jwt-ç®€ä»‹\"></a></h3>\n<h4 id=\"ä»€ä¹ˆæ˜¯jwt\">ä»€ä¹ˆæ˜¯JWT<a title=\"#ä»€ä¹ˆæ˜¯jwt\" href=\"#ä»€ä¹ˆæ˜¯jwt\"></a></h4>\n<ul>\n<li>JSON Web Tokenæ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰</li>\n<li>å®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”ç‹¬ç«‹çš„æ–¹å¼ï¼Œå¯ä»¥å°†å„æ–¹ä¹‹é—´çš„ä¿¡æ¯ä½œä¸ºJSONå¯¹è±¡è¿›è¡Œå®‰å…¨ä¼ è¾“</li>\n<li>è¯¥ä¿¡æ¯å¯ä»¥éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºæ˜¯ç»è¿‡æ•°å­—ç­¾åçš„</li>\n</ul>\n<h4 id=\"jwtçš„æ„æˆ\">JWTçš„æ„æˆ<a title=\"#jwtçš„æ„æˆ\" href=\"#jwtçš„æ„æˆ\"></a></h4>\n<ul>\n<li>å¤´éƒ¨ï¼ˆHeaderï¼‰\n<ul>\n<li>typ: tokençš„ç±»å‹ï¼Œ è¿™é‡Œå›ºå®šä¸ºJWT</li>\n<li>alg: ä½¿ç”¨çš„hashç®—æ³•ï¼Œä¾‹å¦‚ï¼šHMACSHA256æˆ–è€…RSA</li>\n<li>ç¼–ç å‰: {â€œalgâ€:â€œHS256â€,â€œtypâ€:â€œJWTâ€}</li>\n<li>Base64ç¼–ç : â€˜eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9â€™</li>\n</ul>\n</li>\n<li>æœ‰æ•ˆè½½è·ï¼ˆPayloadï¼‰\n<ul>\n<li>å­˜å‚¨éœ€è¦ä¼ é€’çš„ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·IDã€ç”¨æˆ·åç­‰</li>\n<li>è¿˜åŒ…å«å…ƒæ•°æ®ï¼Œå¦‚è¿‡æœŸæ—¶é—´ã€å‘å¸ƒäººç­‰</li>\n<li>ä¸Headerä¸åŒï¼ŒPayloadå¯ä»¥åŠ å¯†</li>\n<li>ç¼–ç å‰: {â€œuser_idâ€:â€œzhangsanâ€}</li>\n<li>Base64ç¼–ç : â€˜eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQ==â€™</li>\n<li>Base64Urlç¼–ç : â€˜eyJ1c2VyX2lkIjoiemhhbmdzYW4ifQâ€™</li>\n</ul>\n</li>\n<li>ç­¾åï¼ˆSignatureï¼‰\n<ul>\n<li>å¯¹Headerå’ŒPayloadéƒ¨åˆ†è¿›è¡Œç­¾å</li>\n<li>ä¿è¯Tokenåœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹æˆ–è€…æŸå</li>\n<li>Signature = HMACSHA256(base64UrlEncode(header)+â€œ.â€+base64UrlEncode(payload), secret)</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"jwtå·¥ä½œåŸç†\">JWTå·¥ä½œåŸç†<a title=\"#jwtå·¥ä½œåŸç†\" href=\"#jwtå·¥ä½œåŸç†\"></a></h4>\n<!-- ![JWTå·¥ä½œåŸç†](#) -->\n<image src=\"https://blog-1251959181.cos.ap-beijing.myqcloud.com/posts/354/JWT.png\" />\n<h3 id=\"8-3-jwt-vs.-session\">8-3 JWT vs. Session<a title=\"#8-3-jwt-vs.-session\" href=\"#8-3-jwt-vs.-session\"></a></h3>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"padding:0\"></th>\n<th style=\"text-align:center\">JWT</th>\n<th style=\"text-align:center\">Session</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">å¯æ‹“å±•æ€§</td>\n<td style=\"text-align:center\">æ— ç¼æ°´å¹³æ‹“å±•</td>\n<td style=\"text-align:center\">é€‚åˆå‚ç›´æ‹“å±•</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">å®‰å…¨æ€§</td>\n<td style=\"text-align:center\">JSå¯ä¿®æ”¹JWTï¼Œç­¾å+åŠ å¯†</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">RESTful API</td>\n<td style=\"text-align:center\">æ— çŠ¶æ€</td>\n<td style=\"text-align:center\">æœ‰çŠ¶æ€</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ€§èƒ½</td>\n<td style=\"text-align:center\">ä¼ è¾“ä¿¡æ¯å¤šï¼Œè¯·æ±‚å¼€é”€å¤§</td>\n<td style=\"text-align:center\">éœ€è¦æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ï¼ŒæœåŠ¡å™¨å¼€é”€å¤§</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ—¶æ•ˆæ€§</td>\n<td style=\"text-align:center\">åªæœ‰åˆ°æœŸæ‰å¯é”€æ¯</td>\n<td style=\"text-align:center\">å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ›´æ–°</td>\n</tr>\n</tbody>\n</table></div></div><h3 id=\"8-4-åœ¨-node.js-ä¸­ä½¿ç”¨-jwt\">8-4 åœ¨ Node.js ä¸­ä½¿ç”¨ JWT<a title=\"#8-4-åœ¨-node.js-ä¸­ä½¿ç”¨-jwt\" href=\"#8-4-åœ¨-node.js-ä¸­ä½¿ç”¨-jwt\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£… jsonwebtoken</li>\n<li>ç­¾å</li>\n<li>éªŒè¯</li>\n</ul>\n</blockquote>\n<p><code>npm i jsonwebtoken</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">jwt = require(<span class=\"string\">&#x27;jsonwebtoken&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">token = jwt.sign(&#123;name: <span class=\"string\">&#x27;vincente&#x27;</span>&#125;, <span class=\"string\">&#x27;secret&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">jwt.decode(token);</span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">jwt.verify(token, <span class=\"string\">&#x27;secret&#x27;</span>);</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"8-5-å®ç°ç”¨æˆ·æ³¨å†Œ\">8-5 å®ç°ç”¨æˆ·æ³¨å†Œ<a title=\"#8-5-å®ç°ç”¨æˆ·æ³¨å†Œ\" href=\"#8-5-å®ç°ç”¨æˆ·æ³¨å†Œ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡ç”¨æˆ·Schema</li>\n<li>ç¼–å†™ä¿è¯å”¯ä¸€æ€§çš„é€»è¾‘</li>\n</ul>\n</blockquote>\n<h4 id=\"è®¾è®¡ç”¨æˆ·schema\">è®¾è®¡ç”¨æˆ·Schema<a title=\"#è®¾è®¡ç”¨æˆ·schema\" href=\"#è®¾è®¡ç”¨æˆ·schema\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,   <span class=\"comment\">// éšè—æ— ç”¨è¿”å›</span></span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;   <span class=\"comment\">// é»˜è®¤ä¸æš´éœ²å¯†ç </span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>).<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">update</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findByIdAndUpdate</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>, ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">patch</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, update);</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™ä¿è¯å”¯ä¸€æ€§çš„é€»è¾‘\">ç¼–å†™ä¿è¯å”¯ä¸€æ€§çš„é€»è¾‘<a title=\"#ç¼–å†™ä¿è¯å”¯ä¸€æ€§çš„é€»è¾‘\" href=\"#ç¼–å†™ä¿è¯å”¯ä¸€æ€§çš„é€»è¾‘\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; name &#125; = ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> repeatedUser = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findOne</span>(&#123; name &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (repeatedUser) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">409</span>, <span class=\"string\">&#x27;ç”¨æˆ·åå·²è¢«å ç”¨&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>).<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-6-å®ç°ç™»å½•å¹¶è·å–-token\">8-6 å®ç°ç™»å½•å¹¶è·å– Token<a title=\"#8-6-å®ç°ç™»å½•å¹¶è·å–-token\" href=\"#8-6-å®ç°ç™»å½•å¹¶è·å–-token\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>ç™»å½•æ¥å£è®¾è®¡</li>\n<li>ç”¨jsonwebtokenç”Ÿæˆtoken</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; find, findById, create,</span><br><span class=\"line\">    update, <span class=\"attr\">delete</span>: del, login</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/login&#x27;</span>, login);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/config.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">secret</span>: <span class=\"string\">&#x27;zhihu-jwt-secert&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">connectionStr</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jsonwebtoken = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">login</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findOne</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">401</span>, <span class=\"string\">&#x27;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; _id, name &#125; = user;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = jsonwebtoken.<span class=\"title function_\">sign</span>(&#123; _id, name &#125;, secret, &#123; <span class=\"attr\">expriseIn</span>: <span class=\"string\">&#x27;1d&#x27;</span> &#125;);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = &#123; token &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-7-è‡ªå·±ç¼–å†™-koa-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\">8-7 è‡ªå·±ç¼–å†™ Koa ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ<a title=\"#8-7-è‡ªå·±ç¼–å†™-koa-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\" href=\"#8-7-è‡ªå·±ç¼–å†™-koa-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¤è¯ï¼šéªŒè¯token ï¼Œå¹¶è·å–ç”¨æˆ·ä¿¡æ¯</li>\n<li>æˆæƒï¼šä½¿ç”¨ä¸­é—´ä»¶ä¿æŠ¤æ¥å£</li>\n</ul>\n</blockquote>\n<h4 id=\"è®¤è¯\">è®¤è¯<a title=\"#è®¤è¯\" href=\"#è®¤è¯\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jsonwebtoken = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; secret &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">auth</span> = <span class=\"keyword\">async</span> (<span class=\"params\">ctx, next</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; authorization = <span class=\"string\">&#x27;&#x27;</span> &#125; = ctx.<span class=\"property\">request</span>.<span class=\"property\">header</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = authorization.<span class=\"title function_\">replace</span>(<span class=\"string\">&#x27;Bearer &#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> user = jsonwebtoken.<span class=\"title function_\">verify</span>(token, secret);</span><br><span class=\"line\">        ctx.<span class=\"property\">state</span>.<span class=\"property\">user</span> = user;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">401</span>, err.<span class=\"property\">message</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, find);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, create);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, findById);</span><br><span class=\"line\">router.<span class=\"title function_\">patch</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, update);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, del);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/login&#x27;</span>, login);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<h4 id=\"æˆæƒ\">æˆæƒ<a title=\"#æˆæƒ\" href=\"#æˆæƒ\"></a></h4>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">checkOwner</span>(<span class=\"params\">ctx, next</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> !== ctx.<span class=\"property\">state</span>.<span class=\"property\">user</span>.<span class=\"property\">_id</span>) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">403</span>, <span class=\"string\">&#x27;æ²¡æœ‰æƒé™&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">patch</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, checkOwner, update);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, checkOwner, del);</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-8-ç”¨-koa-jwt-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\">8-8 ç”¨ koa-jwt ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ<a title=\"#8-8-ç”¨-koa-jwt-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\" href=\"#8-8-ç”¨-koa-jwt-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£… koa-jwt</li>\n<li>ä½¿ç”¨ä¸­é—´ä»¶ä¿æŠ¤æ¥å£</li>\n<li>ä½¿ç”¨ä¸­é—´ä»¶è·å–ç”¨æˆ·ä¿¡æ¯</li>\n</ul>\n</blockquote>\n<p><code>npm i koa-jwt --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-jwt&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; secret &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> auth = <span class=\"title function_\">jwt</span>(&#123; secret &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬9ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—\">ç¬¬9ç«  é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—<a title=\"#ç¬¬9ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—\" href=\"#ç¬¬9ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£ Koa æ¡†æ¶å¦‚ä½•å®ç°ä¸Šä¼ ã€‚å‡¡äº‹ä»éœ€æ±‚åˆ†æå…¥æ‰‹ï¼Œé€šè¿‡ä½¿ç”¨ Koa æ¡†æ¶çš„ä¸­é—´ä»¶å®ç°è·å–ä¸Šä¼ çš„æ–‡ä»¶ä»¥åŠç”Ÿæˆå›¾ç‰‡çš„é“¾æ¥ã€‚</p>\n</blockquote>\n<h3 id=\"9-1-ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ\">9-1 ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ<a title=\"#9-1-ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ\" href=\"#9-1-ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ\"></a></h3>\n<ul>\n<li>ä¸Šä¼ å›¾ç‰‡çš„éœ€æ±‚åœºæ™¯\n<ul>\n<li>ç”¨æˆ·å¤´åƒ</li>\n<li>å°é¢å›¾ç‰‡</li>\n<li>é—®é¢˜å’Œå›ç­”ä¸­çš„å›¾ç‰‡</li>\n<li>è¯é¢˜å›¾ç‰‡</li>\n</ul>\n</li>\n<li>ä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ç‚¹\n<ul>\n<li>åŸºç¡€åŠŸèƒ½ï¼šä¸Šä¼ å›¾ç‰‡ã€ç”Ÿæˆå›¾ç‰‡é“¾æ¥</li>\n<li>é™„åŠ åŠŸèƒ½ï¼šé™åˆ¶ä¸Šä¼ å›¾ç‰‡çš„å¤§å°ä¸ç±»å‹ã€ç”Ÿæˆé«˜ä¸­ä½ä¸‰ç§åˆ†è¾¨ç‡çš„å›¾ç‰‡é“¾æ¥ã€ç”ŸæˆCDN</li>\n</ul>\n</li>\n<li>ä¸Šä¼ å›¾ç‰‡çš„æŠ€æœ¯æ–¹æ¡ˆ\n<ul>\n<li>é˜¿é‡Œäº‘OSSç­‰äº‘æœåŠ¡ï¼Œæ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨</li>\n<li>ç›´æ¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸­ä½¿ç”¨</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"9-2-ä½¿ç”¨-koa-body-ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶\">9-2 ä½¿ç”¨ koa-body ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶<a title=\"#9-2-ä½¿ç”¨-koa-body-ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶\" href=\"#9-2-ä½¿ç”¨-koa-body-ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£…koa-body ï¼Œæ›¿æ¢koa-bodyparser</li>\n<li>è®¾ç½®å›¾ç‰‡ä¸Šä¼ ç›®å½•</li>\n<li>ä½¿ç”¨Postmanä¸Šä¼ æ–‡ä»¶</li>\n</ul>\n</blockquote>\n<p><code>npm i koa-body --save</code></p>\n<p><code>npm uninstall koa-bodyparser</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> koaBody = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-body&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-json-error&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> parameter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-parameter&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; connectionStr &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(connectionStr, &#123; <span class=\"attr\">useNewUrlParser</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;MongoDB è¿æ¥æˆåŠŸ&#x27;</span>));</span><br><span class=\"line\">mongoose.<span class=\"property\">connection</span>.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"variable language_\">console</span>.<span class=\"property\">error</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">error</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">postFormat</span>: <span class=\"function\">(<span class=\"params\">e, &#123; stack, ...rest &#125;</span>) =&gt;</span> process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> === <span class=\"string\">&#x27;production&#x27;</span> ? rest : &#123; stack , ...rest &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">koaBody</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">multipart</span>: <span class=\"literal\">true</span>,    <span class=\"comment\">// å…è®¸ä¼ è¾“æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"attr\">formidable</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">uploadDir</span>: path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;/public/uploads&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">keepExtensions</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">parameter</span>(app));</span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HomeCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">index</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;&lt;h1&gt;This is home page.&lt;/h1&gt;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">upload</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> file = ctx.<span class=\"property\">request</span>.<span class=\"property\">files</span>.<span class=\"property\">file</span>;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">path</span>: file.<span class=\"property\">path</span> &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">HomeCtl</span>(); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; index &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/home&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, index);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/upload&#x27;</span>, upload);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-3-ä½¿ç”¨-koa-static-ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥\">9-3 ä½¿ç”¨ koa-static ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥<a title=\"#9-3-ä½¿ç”¨-koa-static-ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥\" href=\"#9-3-ä½¿ç”¨-koa-static-ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£…koa-static</li>\n<li>è®¾ç½®é™æ€æ–‡ä»¶ç›®å½•</li>\n<li>ç”Ÿæˆå›¾ç‰‡é“¾æ¥</li>\n</ul>\n</blockquote>\n<p><code>npm i koa-static --save</code></p>\n<figure class=\"highlight js\"><figcaption><span>/app/index.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> koaBody = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-body&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> koaStatic = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-static&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-json-error&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> parameter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-parameter&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> routing = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; connectionStr &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(connectionStr, &#123; <span class=\"attr\">useNewUrlParser</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;MongoDB è¿æ¥æˆåŠŸ&#x27;</span>));</span><br><span class=\"line\">mongoose.<span class=\"property\">connection</span>.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"variable language_\">console</span>.<span class=\"property\">error</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">koaStatic</span>(path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;public&#x27;</span>)));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">error</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">postFormat</span>: <span class=\"function\">(<span class=\"params\">e, &#123; stack, ...rest &#125;</span>) =&gt;</span> process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> === <span class=\"string\">&#x27;production&#x27;</span> ? rest : &#123; stack , ...rest &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">koaBody</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">multipart</span>: <span class=\"literal\">true</span>,    <span class=\"comment\">// å…è®¸ä¼ è¾“æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"attr\">formidable</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">uploadDir</span>: path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;/public/uploads&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">keepExtensions</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">parameter</span>(app));</span><br><span class=\"line\"><span class=\"title function_\">routing</span>(app);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;program running at localhost:3000&#x27;</span>)); </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/home.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HomeCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">index</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;&lt;h1&gt;This is home page.&lt;/h1&gt;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">upload</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> file = ctx.<span class=\"property\">request</span>.<span class=\"property\">files</span>.<span class=\"property\">file</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> basename = path.<span class=\"title function_\">basename</span>(file.<span class=\"property\">path</span>);</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = &#123; <span class=\"attr\">url</span>: <span class=\"string\">`<span class=\"subst\">$&#123;ctx.origin&#125;</span>/uploads/<span class=\"subst\">$&#123;basename&#125;</span>`</span> &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">HomeCtl</span>(); </span><br></pre></td></tr></table></figure>\n<h3 id=\"9-4-ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶\">9-4 ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶<a title=\"#9-4-ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶\" href=\"#9-4-ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>ç¼–å†™ä¸Šä¼ æ–‡ä»¶çš„å‰ç«¯é¡µé¢</li>\n<li>ä¸åç«¯æ¥å£è”è°ƒæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight html\"><figcaption><span>/app/public/upload.html</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/upload&quot;</span> <span class=\"attr\">entype</span>=<span class=\"string\">&quot;mutipart/form-data&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;POST&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">accept</span>=<span class=\"string\">&quot;.png, image/jpg&quot;</span>/&gt;</span>   // æ¥å—jpg/pngï¼Œimage/*è¡¨ç¤ºæ‰€æœ‰å›¾ç‰‡ç±»å‹</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>ä¸Šä¼ <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬10ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å—-â€”â€”-å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹\">ç¬¬10ç«  é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å— â€”â€” å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹<a title=\"#ç¬¬10ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å—-â€”â€”-å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹\" href=\"#ç¬¬10ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å—-â€”â€”-å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£å¦‚ä½•è®¾è®¡å¤æ‚çš„ MongoDB æ•°æ®ç±»å‹ã€‚ä»éœ€æ±‚åˆ†æå¼€å§‹ï¼Œåˆ° schema çš„è®¾è®¡ï¼Œå†åˆ°å‚æ•°çš„æ ¡éªŒã€‚æœ€åï¼Œè¿˜è¦å®ç° RESTful API çš„æœ€ä½³å®è·µã€‚</p>\n</blockquote>\n<h3 id=\"10-1-ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ\">10-1 ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ<a title=\"#10-1-ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ\" href=\"#10-1-ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ\"></a></h3>\n<p>ä¸ªäººèµ„æ–™åŠŸèƒ½ç‚¹ï¼š</p>\n<ul>\n<li>ä¸åŒç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰çš„å±æ€§</li>\n<li>å­—æ®µè¿‡æ»¤</li>\n</ul>\n<h3 id=\"10-2-ä¸ªäººèµ„æ–™çš„-schema-è®¾è®¡\">10-2 ä¸ªäººèµ„æ–™çš„ schema è®¾è®¡<a title=\"#10-2-ä¸ªäººèµ„æ–™çš„-schema-è®¾è®¡\" href=\"#10-2-ä¸ªäººèµ„æ–™çš„-schema-è®¾è®¡\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆ†æä¸ªäººèµ„æ–™çš„æ•°æ®ç»“æ„</li>\n<li>è®¾è®¡ä¸ªäººèµ„æ–™çš„schema</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">enum</span>: [<span class=\"string\">&#x27;male&#x27;</span>, <span class=\"string\">&#x27;female&#x27;</span>], <span class=\"attr\">default</span>: <span class=\"string\">&#x27;male&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">headline</span>:  &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">locations</span>: &#123; <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;] &#125;,</span><br><span class=\"line\">    <span class=\"attr\">business</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">employments</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">company</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">job</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;</span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">educations</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">school</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">major</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">diploma</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">enum</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>] &#125;,</span><br><span class=\"line\">            <span class=\"attr\">entrance_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">graduation_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;</span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<h3 id=\"10-3-ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ\">10-3 ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ<a title=\"#10-3-ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ\" href=\"#10-3-ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆ†æä¸ª äººèµ„æ–™çš„æ•°æ®ç»“æ„</li>\n<li>ç¼–å†™ä»£ç æ ¡éªŒä¸ªäººèµ„æ–™å‚æ•°</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">update</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">gender</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">headline</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">locations</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;array&#x27;</span>, <span class=\"attr\">itemType</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">business</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">employments</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;array&#x27;</span>, <span class=\"attr\">itemType</span>: <span class=\"string\">&#x27;object&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">        <span class=\"attr\">educations</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;array&#x27;</span>, <span class=\"attr\">itemType</span>: <span class=\"string\">&#x27;object&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findByIdAndUpdate</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>, ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"10-4-restful-api-æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤\">10-4 RESTful API æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤<a title=\"#10-4-restful-api-æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤\" href=\"#10-4-restful-api-æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡schemaé»˜è®¤éšè—éƒ¨åˆ†å­—æ®µ</li>\n<li>é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸² æ˜¾ç¤ºéšè—å­—æ®µ</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">enum</span>: [<span class=\"string\">&#x27;male&#x27;</span>, <span class=\"string\">&#x27;female&#x27;</span>], <span class=\"attr\">default</span>: <span class=\"string\">&#x27;male&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">headline</span>:  &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">locations</span>: &#123; <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;], <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">business</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">employments</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">company</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">job</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">educations</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">school</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">major</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">diploma</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">enum</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>] &#125;,</span><br><span class=\"line\">            <span class=\"attr\">entrance_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">graduation_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; fields &#125; = ctx.<span class=\"property\">query</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> selectFields = fields.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> f).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> <span class=\"string\">&#x27; +&#x27;</span> + f).<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(selectFields);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬11ç« -é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—\">ç¬¬11ç«  é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—<a title=\"#ç¬¬11ç« -é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—\" href=\"#ç¬¬11ç« -é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£é¡¹ç›®ä¸­å…³æ³¨ä¸ç²‰ä¸æ¨¡å—çš„è®¾è®¡ä¸å®ç°ã€‚è¦†ç›–äº†æ•°æ®åº“ä¸­çš„ç»å…¸å¤šå¯¹å¤šå…³ç³»çš„è®¾è®¡ï¼Œä»¥åŠ RESTful é£æ ¼çš„æ¥å£è®¾è®¡ä¸å®ç°ã€‚æœ€åï¼Œè¿˜ç¼–å†™äº†ç”¨æ¥æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ Koa ä¸­é—´ä»¶ã€‚</p>\n</blockquote>\n<h3 id=\"11-1-å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ\">11-1 å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ<a title=\"#11-1-å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ\" href=\"#11-1-å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ\"></a></h3>\n<p>ç»†åŒ–å…³æ³¨ä¸ç²‰ä¸åŠŸèƒ½ç‚¹:</p>\n<ul>\n<li>å…³æ³¨ã€å–æ¶ˆå…³æ³¨</li>\n<li>è·å–å…³æ³¨äººã€ç²‰ä¸åˆ—è¡¨ï¼ˆç”¨æˆ·-ç”¨æˆ·å¤šå¯¹å¤šå…³ç³»ï¼‰</li>\n</ul>\n<h3 id=\"11-2-å…³æ³¨ä¸ç²‰ä¸çš„-schema-è®¾è®¡\">11-2 å…³æ³¨ä¸ç²‰ä¸çš„ schema è®¾è®¡<a title=\"#11-2-å…³æ³¨ä¸ç²‰ä¸çš„-schema-è®¾è®¡\" href=\"#11-2-å…³æ³¨ä¸ç²‰ä¸çš„-schema-è®¾è®¡\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>åˆ†æå…³æ³¨ ä¸ç²‰ä¸çš„æ•°æ®ç»“æ„</li>\n<li>è®¾è®¡å…³æ³¨ä¸ç²‰ä¸schema</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">enum</span>: [<span class=\"string\">&#x27;male&#x27;</span>, <span class=\"string\">&#x27;female&#x27;</span>], <span class=\"attr\">default</span>: <span class=\"string\">&#x27;male&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">headline</span>:  &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">locations</span>: &#123; <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;], <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">business</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">employments</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">company</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">job</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">educations</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">school</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">major</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">diploma</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">enum</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>] &#125;,</span><br><span class=\"line\">            <span class=\"attr\">entrance_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">graduation_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">following</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;User&#x27;</span> &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<h3 id=\"11-3-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰\">11-3 RESTful é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰<a title=\"#11-3-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰\" href=\"#11-3-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰\"></a></h3>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">listFollowing</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+following&#x27;</span>).<span class=\"title function_\">populate</span>(<span class=\"string\">&#x27;following&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user.<span class=\"property\">following</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">follow</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> me = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+following&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!me.<span class=\"property\">following</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">id</span> =&gt;</span> id.<span class=\"title function_\">toString</span>()).<span class=\"title function_\">includes</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>)) &#123;</span><br><span class=\"line\">        me.<span class=\"property\">following</span>.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">        me.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner,</span><br><span class=\"line\">    listFollowing, follow</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id/following&#x27;</span>, listFollowing);</span><br><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/following/:id&#x27;</span>, auth, follow);</span><br></pre></td></tr></table></figure>\n<h3 id=\"11-4-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰\">11-4 RESTful é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰<a title=\"#11-4-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰\" href=\"#11-4-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰\"></a></h3>\n<p>å–æ¶ˆå…³æ³¨</p>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">unfollow</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> me = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+following&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = me.<span class=\"property\">following</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">id</span> =&gt;</span> id.<span class=\"title function_\">toString</span>()).<span class=\"title function_\">indexOf</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(index &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        me.<span class=\"property\">following</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">        me.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner,</span><br><span class=\"line\">    listFollowing, follow, unfollow</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/following/:id&#x27;</span>, auth, unfollow);</span><br></pre></td></tr></table></figure>\n<p>è·å–ç²‰ä¸</p>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">listFollowers</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> users = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">find</span>(&#123; <span class=\"attr\">following</span>: ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> &#125;);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = users;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner,</span><br><span class=\"line\">    listFollowing, listFollowers,</span><br><span class=\"line\">    follow, unfollow</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id/followers&#x27;</span>, listFollowers);</span><br></pre></td></tr></table></figure>\n<h3 id=\"11-5-ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶\">11-5 ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶<a title=\"#11-5-ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶\" href=\"#11-5-ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">checkUserExist</span>(<span class=\"params\">ctx, next</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner,</span><br><span class=\"line\">    listFollowing, listFollowers,</span><br><span class=\"line\">    checkUserExist, follow, unfollow</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/following/:id&#x27;</span>, auth, checkUserExist, follow);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/following/:id&#x27;</span>, auth, checkUserExist, unfollow);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬12ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰\">ç¬¬12ç«  é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰<a title=\"#ç¬¬12ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰\" href=\"#ç¬¬12ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦å›´ç»•è¯é¢˜åŠŸèƒ½æ¨¡å—è¿›è¡Œè®²è§£ï¼ŒåŒ…æ‹¬è¯é¢˜æ¨¡å—æœ¬èº«å’Œç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨ã€‚è¦†ç›–å¤šä¸ªæ¯”å¦‚åˆ†é¡µã€æ¨¡ç³Šæœç´¢ç­‰ç­‰çš„ RESTful APIæœ€ä½³å®è·µï¼Œè¿˜åŒ…æ‹¬äº†æ•°æ®åº“å¼•ç”¨çš„å®è·µå“¦~</p>\n</blockquote>\n<h3 id=\"12-1-è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\">12-1 è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ<a title=\"#12-1-è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\" href=\"#12-1-è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\"></a></h3>\n<p>è¯é¢˜æ¨¡å—åŠŸèƒ½ç‚¹</p>\n<ul>\n<li>è¯é¢˜çš„<strong>å¢æ”¹æŸ¥</strong></li>\n<li>åˆ†é¡µã€æ¨¡ç³Šæœç´¢</li>\n<li>ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨</li>\n<li>å…³æ³¨/å–æ¶ˆå…³æ³¨è¯é¢˜ã€ç”¨æˆ·å…³æ³¨çš„è¯é¢˜åˆ—è¡¨</li>\n</ul>\n<h3 id=\"12-2-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰\">12-2 RESTful é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰<a title=\"#12-2-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰\" href=\"#12-2-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡Schema</li>\n<li>å®ç°RESTfulé£æ ¼çš„å¢æ”¹æŸ¥æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> topicSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">introduction</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;Topic&#x27;</span>, topicSchema);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Topics</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../models/topics&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TopicCtl</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">find</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; fields = <span class=\"string\">&#x27;&#x27;</span> &#125; = ctx.<span class=\"property\">query</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> selectFields = fields.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> f).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> <span class=\"string\">&#x27; +&#x27;</span> + f).<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> topic = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(selectFields);</span><br><span class=\"line\">        <span class=\"comment\">// if (!topic) &#123; ctx.throw(404, &#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;); &#125;</span></span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = topic;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">create</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">introduction</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> topic = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Topic</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>).<span class=\"title function_\">save</span>();</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = topic;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">update</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"title function_\">verifyParams</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">introduction</span>: &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;string&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> topic = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">findByIdAndUpdate</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>, ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!topic) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">        ctx.<span class=\"property\">body</span> = topic;   <span class=\"comment\">// è¿™é‡Œçš„topicæ˜¯æ›´æ–°å‰çš„</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">TopicCtl</span>();</span><br></pre></td></tr></table></figure>\n<h3 id=\"12-3-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰\">12-3 RESTful é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰<a title=\"#12-3-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰\" href=\"#12-3-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰\"></a></h3>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-jwt&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-router&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>(&#123; <span class=\"attr\">prefix</span>: <span class=\"string\">&#x27;/topics&#x27;</span> &#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/topics&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; secret &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../config&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> auth = <span class=\"title function_\">jwt</span>(&#123; secret &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, find);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, auth, create);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, findById);</span><br><span class=\"line\">router.<span class=\"title function_\">patch</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, update);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router;</span><br></pre></td></tr></table></figure>\n<h3 id=\"12-4-restful-api-æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ\">12-4 RESTful API æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ<a title=\"#12-4-restful-api-æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ\" href=\"#12-4-restful-api-æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°åˆ†é¡µé€»è¾‘</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; per_page = <span class=\"number\">10</span> &#125; = ctx.<span class=\"property\">query</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(ctx.<span class=\"property\">query</span>.<span class=\"property\">page</span> * <span class=\"number\">1</span>, <span class=\"number\">1</span>) - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> perPage = <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(per_page * <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">find</span>().<span class=\"title function_\">limit</span>(perPage).<span class=\"title function_\">skip</span>(page * perPage);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç…§æ¬åˆ°ç”¨æˆ·</p>\n<h3 id=\"12-5-restful-api-æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢\">12-5 RESTful API æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢<a title=\"#12-5-restful-api-æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢\" href=\"#12-5-restful-api-æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°æ¨¡ç³Šæœç´¢é€»è¾‘</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">find</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; per_page = <span class=\"number\">10</span> &#125; = ctx.<span class=\"property\">query</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(ctx.<span class=\"property\">query</span>.<span class=\"property\">page</span> * <span class=\"number\">1</span>, <span class=\"number\">1</span>) - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> perPage = <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(per_page * <span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span></span><br><span class=\"line\">        .<span class=\"title function_\">find</span>(&#123; <span class=\"attr\">name</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(ctx.<span class=\"property\">query</span>.<span class=\"property\">q</span>) &#125;)</span><br><span class=\"line\">        .<span class=\"title function_\">limit</span>(perPage).<span class=\"title function_\">skip</span>(page * perPage);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"12-6-ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨\">12-6 ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨<a title=\"#12-6-ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨\" href=\"#12-6-ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>ä½¿ç”¨è¯é¢˜å¼•ç”¨æ›¿ä»£éƒ¨åˆ†ç”¨æˆ·å±æ€§</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">avatar_url</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">enum</span>: [<span class=\"string\">&#x27;male&#x27;</span>, <span class=\"string\">&#x27;female&#x27;</span>], <span class=\"attr\">default</span>: <span class=\"string\">&#x27;male&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">headline</span>:  &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">locations</span>: &#123; <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span> &#125;], <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">business</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">employments</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">company</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span>, &#125;,</span><br><span class=\"line\">            <span class=\"attr\">job</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span>, &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">educations</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123;</span><br><span class=\"line\">            <span class=\"attr\">school</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span>, &#125;,</span><br><span class=\"line\">            <span class=\"attr\">major</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span>, &#125;,</span><br><span class=\"line\">            <span class=\"attr\">diploma</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">enum</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>] &#125;,</span><br><span class=\"line\">            <span class=\"attr\">entrance_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;,</span><br><span class=\"line\">            <span class=\"attr\">graduation_year</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span> &#125;</span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">following</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;User&#x27;</span> &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">findById</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; fields &#125; = ctx.<span class=\"property\">query</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> selectFields = fields.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> f).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> <span class=\"string\">&#x27; +&#x27;</span> + f).<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> populateStr = fields.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> f).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(f === <span class=\"string\">&#x27;employments&#x27;</span>) &#123; <span class=\"keyword\">return</span> <span class=\"string\">&#x27;employments.company employments.job&#x27;</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(f === <span class=\"string\">&#x27;education&#x27;</span>) &#123; <span class=\"keyword\">return</span> <span class=\"string\">&#x27;education.school education.major&#x27;</span> &#125;</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">join</span>(<span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(selectFields)</span><br><span class=\"line\">        .<span class=\"title function_\">populate</span>(populateStr);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"12-7-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰\">12-7 RESTful é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰<a title=\"#12-7-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰\" href=\"#12-7-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°å…³æ³¨è¯é¢˜é€»è¾‘ï¼ˆç”¨æˆ·-è¯é¢˜å¤šå¯¹å¤šå…³ç³»ï¼‰</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> userSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">followingTopics</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: [&#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;Topic&#x27;</span> &#125;],</span><br><span class=\"line\">        <span class=\"attr\">select</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">checkTopicExist</span>(<span class=\"params\">ctx, next</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> topic = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!topic) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;è¯é¢˜ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">listFollowingTopics</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> user = <span class=\"keyword\">await</span> <span class=\"title class_\">Topic</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+followingTopics&#x27;</span>).<span class=\"title function_\">populate</span>(<span class=\"string\">&#x27;followingTopics&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!user) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = user.<span class=\"property\">followingTopics</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">followTopic</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> me = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+followingTopics&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!me.<span class=\"property\">followingTopics</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">id</span> =&gt;</span> id.<span class=\"title function_\">toString</span>()).<span class=\"title function_\">includes</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>)) &#123;</span><br><span class=\"line\">        me.<span class=\"property\">followingTopics</span>.<span class=\"title function_\">push</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">        me.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">unfollowTopic</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> me = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+followingTopics&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = me.<span class=\"property\">followingTopics</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">id</span> =&gt;</span> id.<span class=\"title function_\">toString</span>()).<span class=\"title function_\">indexOf</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(index &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        me.<span class=\"property\">followingTopics</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">        me.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">status</span> = <span class=\"number\">204</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    <span class=\"attr\">delete</span>: del, login, checkOwner,</span><br><span class=\"line\">    listFollowing, listFollowers,</span><br><span class=\"line\">    checkUserExist, follow, unfollow,</span><br><span class=\"line\">    followTopic, unfollowTopic</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; checkTopicExist &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/topics&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id/followingTopics&#x27;</span>, followingTopics);</span><br><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/followingTopics/:id&#x27;</span>, auth, checkTopicExist, follow);</span><br><span class=\"line\">router.<span class=\"title function_\">delete</span>(<span class=\"string\">&#x27;/followingTopics/:id&#x27;</span>, auth, checkTopicExist, unfollow);</span><br></pre></td></tr></table></figure>\n<h3 id=\"12-8-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰\">12-8 RESTful é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰<a title=\"#12-8-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰\" href=\"#12-8-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰\"></a></h3>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">listFollowers</span>(<span class=\"params\">ctx</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> users = <span class=\"keyword\">await</span> <span class=\"title class_\">User</span>.<span class=\"title function_\">find</span>(&#123; <span class=\"attr\">followingTopics</span>: ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span> &#125;);</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span> = users;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Topics</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../models/topics&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Users</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../models/users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    find, findById, create, update,</span><br><span class=\"line\">    checkTopicExist, listFollowers</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers/topics&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, find);</span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, auth, create);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, checkTopicExist, findById);</span><br><span class=\"line\">router.<span class=\"title function_\">patch</span>(<span class=\"string\">&#x27;/:id&#x27;</span>, auth, checkTopicExist, update);</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/:id/followers&#x27;</span>, checkTopicExist, listFollowers);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¬¬13ç« -é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å—-â€”â€”-å¤æ‚çš„æ•°æ®åº“è®¾è®¡\">ç¬¬13ç«  é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å— â€”â€” å¤æ‚çš„æ•°æ®åº“è®¾è®¡<a title=\"#ç¬¬13ç« -é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å—-â€”â€”-å¤æ‚çš„æ•°æ®åº“è®¾è®¡\" href=\"#ç¬¬13ç« -é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å—-â€”â€”-å¤æ‚çš„æ•°æ®åº“è®¾è®¡\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦å›´ç»•é—®é¢˜æ¨¡å—è¿›è¡Œå±•å¼€ã€‚é€šè¿‡é—®é¢˜æ¨¡å—çš„å®ç°ï¼Œæ¥å­¦ä¹ æ•°æ®åº“ä¸­çš„ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šå…³ç³»çš„è®¾è®¡ä¸å®ç°ï¼Œå¸¦ä½ é€æ­¥æ·±å…¥åˆ°æ•°æ®åº“çš„å¤æ‚è®¾è®¡ä¸­ã€‚</p>\n</blockquote>\n<h3 id=\"13-1-é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\">13-1 é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ<a title=\"#13-1-é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\" href=\"#13-1-é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ\"></a></h3>\n<p>é—®é¢˜æ¨¡å—åŠŸèƒ½ç‚¹</p>\n<ul>\n<li>é—®é¢˜çš„å¢åˆ æ”¹æŸ¥</li>\n<li>ç”¨æˆ·çš„é—®é¢˜åˆ—è¡¨ï¼ˆç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»ï¼‰</li>\n<li>è¯é¢˜çš„é—®é¢˜åˆ—è¡¨+é—®é¢˜çš„è¯é¢˜åˆ—è¡¨ï¼ˆè¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»ï¼‰</li>\n<li>å…³æ³¨/å–æ¶ˆå…³æ³¨é—®é¢˜</li>\n</ul>\n<h3 id=\"13-2-ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\">13-2 ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°<a title=\"#13-2-ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\" href=\"#13-2-ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°å¢åˆ æ”¹æŸ¥æ¥å£</li>\n<li>å®ç°ç”¨æˆ·çš„é—®é¢˜åˆ—è¡¨æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/topics.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mongoose&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"title class_\">Schema</span>, model &#125; = mongoose;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questionSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">discription</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span> &#125;,</span><br><span class=\"line\">    <span class=\"attr\">questioner</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;User&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">model</span>(<span class=\"string\">&#x27;Question&#x27;</span>, questionSchema);</span><br></pre></td></tr></table></figure>\n<h3 id=\"13-3-è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\">13-3 è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°<a title=\"#13-3-è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\" href=\"#13-3-è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®ç°é—®é¢˜çš„è¯é¢˜åˆ—è¡¨æ¥å£</li>\n<li>å®ç°è¯é¢˜çš„é—®é¢˜åˆ—è¡¨æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<h2 id=\"ç¬¬14ç« -é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å—-â€”â€”-æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡\">ç¬¬14ç«  é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å— â€”â€” æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡<a title=\"#ç¬¬14ç« -é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å—-â€”â€”-æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡\" href=\"#ç¬¬14ç« -é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å—-â€”â€”-æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦å›´ç»•ç­”æ¡ˆæ¨¡å—è¿›è¡Œè®²è§£ã€‚è¦†ç›–äº† RESTful API æœ€ä½³å®è·µ â€”â€” åµŒå¥—è·¯ç”±ã€äº’æ–¥æ¥å£çš„å®ç°ç­‰å†…å®¹ï¼Œå¹¶ä¸”è®²è§£äº†äºŒçº§åµŒå¥—å…³ç³»ä¸­çš„å¢åˆ æ”¹æŸ¥æ¥å£çš„å®ç°ã€‚</p>\n</blockquote>\n<h3 id=\"14-1-ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ\">14-1 ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ<a title=\"#14-1-ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ\" href=\"#14-1-ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ\"></a></h3>\n<p>ç­”æ¡ˆæ¨¡å—åŠŸèƒ½ç‚¹</p>\n<ul>\n<li>ç­”æ¡ˆçš„å¢åˆ æ”¹æŸ¥</li>\n<li>é—®é¢˜ç­”æ¡ˆ/ç”¨æˆ·-ç­”æ¡ˆä¸€å¯¹å¤š</li>\n<li>èµ/è¸©ç­”æ¡ˆ</li>\n<li>æ”¶è—ç­”æ¡ˆ</li>\n</ul>\n<h3 id=\"14-2-é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\">14-2 é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£<a title=\"#14-2-é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\" href=\"#14-2-é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡æ•°æ®åº“Schema</li>\n<li>å®ç°å¢åˆ æ”¹æŸ¥æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/models/answers.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> answerSchema = <span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">__v</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Number</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">content</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">answerer</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">Schema</span>.<span class=\"property\">Types</span>.<span class=\"property\">ObjectId</span>, <span class=\"attr\">ref</span>: <span class=\"string\">&#x27;User&#x27;</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">select</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">questionId</span>: &#123; <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>, <span class=\"attr\">required</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><figcaption><span>/app/controllers/answers.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">checkAnswerExist</span>(<span class=\"params\">ctx, next</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> answer = <span class=\"keyword\">await</span> <span class=\"title class_\">Answer</span>.<span class=\"title function_\">findById</span>(ctx.<span class=\"property\">params</span>.<span class=\"property\">id</span>).<span class=\"title function_\">select</span>(<span class=\"string\">&#x27;+answerer&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!answer) &#123; ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;ç­”æ¡ˆä¸å­˜åœ¨&#x27;</span>); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">params</span>.<span class=\"property\">questionId</span> !== answer.<span class=\"property\">questionId</span>) &#123;</span><br><span class=\"line\">        ctx.<span class=\"keyword\">throw</span>(<span class=\"number\">404</span>, <span class=\"string\">&#x27;è¯¥é—®é¢˜ä¸‹æ²¡æœ‰æ­¤ç­”æ¡ˆ&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">state</span>.<span class=\"property\">answer</span> = answer;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"14-3-äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°\">14-3 äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°<a title=\"#14-3-äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°\" href=\"#14-3-äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡æ•°æ®åº“Schema</li>\n<li>å®ç°æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption><span>/app/routes/users.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">put</span>(<span class=\"string\">&#x27;/likingAnswers/:id&#x27;</span>, auth, checkAnswerExist, likeAnswer, undislikeAnswer);</span><br></pre></td></tr></table></figure>\n<h3 id=\"14-4-restful-é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£\">14-4 RESTful é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£<a title=\"#14-4-restful-é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£\" href=\"#14-4-restful-é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡æ•°æ®åº“Schema</li>\n<li>å®ç°æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<h2 id=\"ç¬¬15ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å—-â€”â€”-æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡\">ç¬¬15ç«  é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å— â€”â€” æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡<a title=\"#ç¬¬15ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å—-â€”â€”-æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡\" href=\"#ç¬¬15ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å—-â€”â€”-æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦å›´ç»•è¯„è®ºæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿›è¡Œå­¦ä¹ ã€‚å…¶ä¸­ï¼ŒåŒ…æ‹¬äº†æœ€å¤æ‚çš„ä¸‰çº§åµŒå¥—æ¥å£çš„è®¾è®¡ä¸å®ç°ï¼Œè¿˜æœ‰æœ‰å…³ä¸€çº§è¯„è®ºã€äºŒçº§è¯„è®ºçš„è®¾è®¡ä¸å®ç°ç­‰å†…å®¹ã€‚</p>\n</blockquote>\n<h3 id=\"15-1-è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ\">15-1 è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ<a title=\"#15-1-è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ\" href=\"#15-1-è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ\"></a></h3>\n<p>è¯„è®ºæ¨¡å—åŠŸèƒ½ç‚¹</p>\n<ul>\n<li>è¯„è®ºçš„å¢åˆ æ”¹æŸ¥</li>\n<li>ç­”æ¡ˆ/é—®é¢˜/ç”¨æˆ·-è¯„è®ºä¸€å¯¹å¤š</li>\n<li>ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®º</li>\n<li>èµ/è¸©è¯„è®º</li>\n</ul>\n<h3 id=\"15-2-é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\">15-2 é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£<a title=\"#15-2-é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\" href=\"#15-2-é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£\"></a></h3>\n<h3 id=\"15-3-ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°\">15-3 ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°<a title=\"#15-3-ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°\" href=\"#15-3-ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡æ•°æ®åº“ Schema</li>\n<li>å®ç°æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<h3 id=\"15-4-æ·»åŠ æ—¥æœŸ\">15-4 æ·»åŠ æ—¥æœŸ<a title=\"#15-4-æ·»åŠ æ—¥æœŸ\" href=\"#15-4-æ·»åŠ æ—¥æœŸ\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>è®¾è®¡æ•°æ®åº“ Schema</li>\n<li>å®ç°æ¥å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•</li>\n</ul>\n</blockquote>\n<h2 id=\"ç¬¬16ç« -ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®\">ç¬¬16ç«  ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®<a title=\"#ç¬¬16ç« -ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®\" href=\"#ç¬¬16ç« -ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®\"></a></h2>\n<blockquote>\n<p>æœ¬ç« ä¸»è¦è®²è§£å¦‚ä½•å°†å¼€å‘å®Œæˆçš„é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚å…¶ä¸­ï¼ŒåŒ…æ‹¬äº†æœåŠ¡å™¨çš„ç¯å¢ƒæ­å»ºã€ç”¨ Nginx å®ç°æœåŠ¡å™¨ç«¯å£çš„è½¬å‘ã€PM2 ç®¡ç†æœåŠ¡è¿›ç¨‹ç­‰ç­‰è¿™äº›å†…å®¹ã€‚</p>\n</blockquote>\n<h3 id=\"16-1-åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git-ä¸-node.js\">16-1 åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Git ä¸ Node.js<a title=\"#16-1-åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git-ä¸-node.js\" href=\"#16-1-åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git-ä¸-node.js\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>SSH ç™»å½•æœåŠ¡å™¨</li>\n<li>å®‰è£…Gitï¼Œä¸‹è½½ä»£ç åˆ°æœåŠ¡å™¨</li>\n<li>å®‰è£…Node.jsï¼Œè¿è¡Œç¨‹åº</li>\n</ul>\n</blockquote>\n<h3 id=\"16-2-ç”¨-nginx-å®ç°ç«¯å£è½¬å‘\">16-2 ç”¨ Nginx å®ç°ç«¯å£è½¬å‘<a title=\"#16-2-ç”¨-nginx-å®ç°ç«¯å£è½¬å‘\" href=\"#16-2-ç”¨-nginx-å®ç°ç«¯å£è½¬å‘\"></a></h3>\n<blockquote>\n<p>æ“ä½œæ­¥éª¤</p>\n<ul>\n<li>å®‰è£…Nginx</li>\n<li>é…ç½®Nginxï¼ŒæŠŠå¤–ç½‘80ç«¯å£è½¬åˆ°å†…ç½‘3000ç«¯å£</li>\n<li>ä½¿ç”¨Postmanæµ‹è¯•å¤–ç½‘æ¥å£</li>\n</ul>\n</blockquote>\n<p><code>nginx -t</code>æ˜¾ç¤ºé…ç½®æ–‡ä»¶ä½ç½®å¹¶æ£€æŸ¥è¯­æ³•</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># include /etc/nginx/sites-enabled/*;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name localhost;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:3000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>nginx -t</code></p>\n<p><code>service nginx restart</code> / <code>service nginx reload</code></p>\n<h3 id=\"16-3-ä½¿ç”¨-pm2-ç®¡ç†è¿›ç¨‹\">16-3 ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹<a title=\"#16-3-ä½¿ç”¨-pm2-ç®¡ç†è¿›ç¨‹\" href=\"#16-3-ä½¿ç”¨-pm2-ç®¡ç†è¿›ç¨‹\"></a></h3>\n<p><code>npm i pm2 -g</code></p>\n<p><code>pm2 start/restart/reload/stop app</code></p>\n<p><code>NODE_ENV=production pm2 start app --update-env</code></p>\n<h2 id=\"ç¬¬17ç« -ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“\">ç¬¬17ç«  ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“<a title=\"#ç¬¬17ç« -ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“\" href=\"#ç¬¬17ç« -ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“\"></a></h2>\n<blockquote>\n<p>æœ€åä¸€ç« å¸¦ç€å¤§å®¶æŠŠæ•´ä¸ªè¯¾ç¨‹å›é¡¾ä¸€éï¼Œå°¤å…¶æ˜¯é‡éš¾ç‚¹ï¼ŒæŠ€æœ¯ç‚¹ã€‚æœ€åæ€»ç»“ç»éªŒã€å¿ƒå¾—ä»¥åŠæ‰©å±•å»ºè®®ç­‰ç­‰ã€‚</p>\n</blockquote>\n<h3 id=\"17-1-å›é¡¾ä¸æ€»ç»“\">17-1 å›é¡¾ä¸æ€»ç»“<a title=\"#17-1-å›é¡¾ä¸æ€»ç»“\" href=\"#17-1-å›é¡¾ä¸æ€»ç»“\"></a></h3>\n<ul>\n<li>è¯¾ç¨‹å›é¡¾\n<ul>\n<li>RESTç†è®ºä¸æœ€ä½³å®è·µ</li>\n<li>Koa2ã€MongoDBã€JWT ç®€ä»‹ä¸å®è·µ</li>\n<li>ä»¿çŸ¥ä¹RESTAPIå®æˆ˜</li>\n</ul>\n</li>\n<li>é‡ç‚¹éš¾ç‚¹\n<ul>\n<li>RESTç†è®ºä¸å®è·µ</li>\n<li>JWTåŸç†åŠNode.jså®ç°</li>\n<li>MongoDB Schemaè®¾è®¡</li>\n</ul>\n</li>\n<li>ç»éªŒå¿ƒå¾—\n<ul>\n<li>RESTful APIè®¾è®¡å‚è€ƒGitHub API v3</li>\n<li>ä½¿ç”¨GitHubæœç´¢Koa2èµ„æº</li>\n<li>ä½¿ç”¨Stack Overflowæœç´¢é—®é¢˜</li>\n</ul>\n</li>\n<li>æ‹“å±•å»ºè®®\n<ul>\n<li>ä½¿ç”¨ä¼ä¸šçº§Node.jsæ¡†æ¶ä¸€Egg.js</li>\n<li>æŒæ¡å¤šè¿›ç¨‹ç¼–ç¨‹çŸ¥è¯†</li>\n<li>å­¦ä¹ ä½¿ç”¨æ—¥å¿—å’Œæ€§èƒ½ç›‘æ§</li>\n</ul>\n</li>\n</ul>\n","prev":{"title":"â€œå¹³å®‰æŠ¥â€è‡ªåŠ¨åŒ– - winç¯‡","link":"2020/09/19/ustb_checkIn_win"},"next":{"title":"Getting Things Done","link":"2020/06/09/share_GTD"},"plink":"https://vincenteliang.com/2020/06/28/imooc_354/","toc":[{"id":"ç¬¬1ç« -å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„","title":"ç¬¬1ç«  å­¦ä¹ ä¹‹å‰è¦å‘Šè¯‰ä½ çš„","index":"1","children":[{"id":"1-1-å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†","title":"1-1 å…³äºè¿™é—¨è¯¾ç¨‹ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™ä¸€èŠ‚é‡Œé¢äº†","index":"1.1"}]},{"id":"ç¬¬2ç« -è·Ÿç€-github-è®¤è¯†-restful-api","title":"ç¬¬2ç«  è·Ÿç€ GitHub è®¤è¯† RESTful API","index":"2","children":[{"id":"2-1-rest-æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„-6-ä¸ªé™åˆ¶","title":"2-1 REST æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„ 6 ä¸ªé™åˆ¶","index":"2.1"},{"id":"2-2-ç»Ÿä¸€æ¥å£çš„é™åˆ¶","title":"2-2 ç»Ÿä¸€æ¥å£çš„é™åˆ¶","index":"2.2"},{"id":"2-3-restful-api-ç®€ä»‹","title":"2-3 RESTful API ç®€ä»‹","index":"2.3"},{"id":"2-4-restful-api-è®¾è®¡æœ€ä½³å®è·µ","title":"2-4 RESTful API è®¾è®¡æœ€ä½³å®è·µ","index":"2.4"}]},{"id":"ç¬¬3ç« -ç”¨-koa-è¯´-hello-world","title":"ç¬¬3ç«  ç”¨ Koa è¯´ Hello World","index":"3","children":[{"id":"3-1-koa-ç®€ä»‹","title":"3-1 Koa ç®€ä»‹","index":"3.1"},{"id":"3-2-å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª-koa-ç¨‹åº","title":"3-2 å®‰è£…æ­å»ºç¬¬ä¸€ä¸ª Koa ç¨‹åº","index":"3.2"},{"id":"3-3-koa-ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹","title":"3-3 Koa ä¸­é—´ä»¶ä¸æ´‹è‘±æ¨¡å‹","index":"3.3"}]},{"id":"ç¬¬4ç« -koa-æ¡†æ¶çš„è·¯ç”±ä¸-restful-api-æœ€ä½³å®è·µ","title":"ç¬¬4ç«  Koa æ¡†æ¶çš„è·¯ç”±ä¸ RESTful API æœ€ä½³å®è·µ","index":"4","children":[{"id":"4-1-è·¯ç”±ç®€ä»‹","title":"4-1 è·¯ç”±ç®€ä»‹","index":"4.1"},{"id":"4-2-è‡ªå·±ç¼–å†™-koa-è·¯ç”±ä¸­é—´ä»¶","title":"4-2 è‡ªå·±ç¼–å†™ Koa è·¯ç”±ä¸­é—´ä»¶","index":"4.2"},{"id":"4-3-ä½¿ç”¨-koa-router-å®ç°è·¯ç”±","title":"4-3 ä½¿ç”¨ koa-router å®ç°è·¯ç”±","index":"4.3"},{"id":"4-4-http-options-æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ","title":"4-4 HTTP options æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ","index":"4.4"},{"id":"4-5-restful-api-æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”","title":"4-5 RESTful API æœ€ä½³å®è·µâ€”â€”å¢åˆ æ”¹æŸ¥åº”è¯¥è¿”å›ä»€ä¹ˆå“åº”","index":"4.5"}]},{"id":"ç¬¬5ç« -koa-æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„","title":"ç¬¬5ç«  Koa æ¡†æ¶çš„æ§åˆ¶å™¨ä»¥åŠè®¾è®¡æ›´åˆç†çš„ç›®å½•ç»“æ„","index":"5","children":[{"id":"5-1-æ§åˆ¶å™¨ç®€ä»‹","title":"5-1 æ§åˆ¶å™¨ç®€ä»‹","index":"5.1"},{"id":"5-2-è·å–-http-è¯·æ±‚å‚æ•°","title":"5-2 è·å– HTTP è¯·æ±‚å‚æ•°","index":"5.2"},{"id":"5-3-å‘é€-http-å“åº”","title":"5-3 å‘é€ HTTP å“åº”","index":"5.3"},{"id":"5-4-æ›´åˆç†çš„ç›®å½•ç»“æ„","title":"5-4 æ›´åˆç†çš„ç›®å½•ç»“æ„","index":"5.4"}]},{"id":"ç¬¬6ç« -å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶","title":"ç¬¬6ç«  å¤šç§æ–¹æ¡ˆå®ç°é”™è¯¯å¤„ç†æœºåˆ¶","index":"6","children":[{"id":"6-1-é”™è¯¯å¤„ç†ç®€ä»‹","title":"6-1 é”™è¯¯å¤„ç†ç®€ä»‹","index":"6.1"},{"id":"6-2-koa-è‡ªå¸¦çš„é”™è¯¯å¤„ç†","title":"6-2 Koa è‡ªå¸¦çš„é”™è¯¯å¤„ç†","index":"6.2"},{"id":"6-3-è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶","title":"6-3 è‡ªå·±ç¼–å†™é”™è¯¯å¤„ç†ä¸­é—´ä»¶","index":"6.3"},{"id":"6-4-ä½¿ç”¨-koa-json-error-è¿›è¡Œé”™è¯¯å¤„ç†","title":"6-4 ä½¿ç”¨ koa-json-error è¿›è¡Œé”™è¯¯å¤„ç†","index":"6.4"},{"id":"6-5-ä½¿ç”¨-koa-parameter-æ ¡éªŒå‚æ•°","title":"6-5 ä½¿ç”¨ koa-parameter æ ¡éªŒå‚æ•°","index":"6.5"}]},{"id":"ç¬¬7ç« -ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~","title":"ç¬¬7ç«  ç¬¬ä¸€æ‰¹ç”¨æˆ·å…¥åº“å•¦~~","index":"7","children":[{"id":"7-1-nosql-ç®€ä»‹","title":"7-1 NoSQL ç®€ä»‹","index":"7.1"},{"id":"7-2-mongodb-ç®€ä»‹","title":"7-2 MongoDB ç®€ä»‹","index":"7.2"},{"id":"7-3-äº‘æ•°æ®åº“â€”â€”mongodb-atlas","title":"7-3 äº‘æ•°æ®åº“â€”â€”MongoDB Atlas","index":"7.3"},{"id":"7-4-ä½¿ç”¨-mongoose-è¿æ¥-mongodb","title":"7-4 ä½¿ç”¨ Mongoose è¿æ¥ MongoDB","index":"7.4"},{"id":"7-5-è®¾è®¡ç”¨æˆ·æ¨¡å—çš„-schema","title":"7-5 è®¾è®¡ç”¨æˆ·æ¨¡å—çš„ Schema","index":"7.5"},{"id":"7-6-ç”¨-mongodb-å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥","title":"7-6 ç”¨ MongoDB å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥","index":"7.6"}]},{"id":"ç¬¬8ç« -jwt-åœ¨-koa-æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ","title":"ç¬¬8ç«  JWT åœ¨ Koa æ¡†æ¶ä¸­å®ç°ç”¨æˆ·çš„è®¤è¯ä¸æˆæƒ","index":"8","children":[{"id":"8-1-session-ç®€ä»‹","title":"8-1 Session ç®€ä»‹","index":"8.1"},{"id":"8-2-jwt-ç®€ä»‹","title":"8-2 JWT ç®€ä»‹","index":"8.2"},{"id":"8-3-jwt-vs.-session","title":"8-3 JWT vs. Session","index":"8.3"},{"id":"8-4-åœ¨-node.js-ä¸­ä½¿ç”¨-jwt","title":"8-4 åœ¨ Node.js ä¸­ä½¿ç”¨ JWT","index":"8.4"},{"id":"8-5-å®ç°ç”¨æˆ·æ³¨å†Œ","title":"8-5 å®ç°ç”¨æˆ·æ³¨å†Œ","index":"8.5"},{"id":"8-6-å®ç°ç™»å½•å¹¶è·å–-token","title":"8-6 å®ç°ç™»å½•å¹¶è·å– Token","index":"8.6"},{"id":"8-7-è‡ªå·±ç¼–å†™-koa-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ","title":"8-7 è‡ªå·±ç¼–å†™ Koa ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ","index":"8.7"},{"id":"8-8-ç”¨-koa-jwt-ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ","title":"8-8 ç”¨ koa-jwt ä¸­é—´ä»¶å®ç°ç”¨æˆ·è®¤è¯ä¸æˆæƒ","index":"8.8"}]},{"id":"ç¬¬9ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—","title":"ç¬¬9ç«  é¡¹ç›®å®æˆ˜ä¹‹ä¸Šä¼ å›¾ç‰‡æ¨¡å—","index":"9","children":[{"id":"9-1-ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ","title":"9-1 ä¸Šä¼ å›¾ç‰‡éœ€æ±‚åˆ†æ","index":"9.1"},{"id":"9-2-ä½¿ç”¨-koa-body-ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶","title":"9-2 ä½¿ç”¨ koa-body ä¸­é—´ä»¶è·å–ä¸Šä¼ çš„æ–‡ä»¶","index":"9.2"},{"id":"9-3-ä½¿ç”¨-koa-static-ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥","title":"9-3 ä½¿ç”¨ koa-static ä¸­é—´ä»¶ç”Ÿæˆå›¾ç‰‡é“¾æ¥","index":"9.3"},{"id":"9-4-ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶","title":"9-4 ç¼–å†™å‰ç«¯é¡µé¢ä¸Šä¼ æ–‡ä»¶","index":"9.4"}]},{"id":"ç¬¬10ç« -é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å—-â€”â€”-å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹","title":"ç¬¬10ç«  é¡¹ç›®å®æˆ˜ä¹‹ä¸ªäººèµ„æ–™æ¨¡å— â€”â€” å­¦ä¹ å¤„ç†å¤æ‚æ•°æ®ç±»å‹","index":"10","children":[{"id":"10-1-ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ","title":"10-1 ä¸ªäººèµ„æ–™éœ€æ±‚åˆ†æ","index":"10.1"},{"id":"10-2-ä¸ªäººèµ„æ–™çš„-schema-è®¾è®¡","title":"10-2 ä¸ªäººèµ„æ–™çš„ schema è®¾è®¡","index":"10.2"},{"id":"10-3-ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ","title":"10-3 ä¸ªäººèµ„æ–™çš„å‚æ•°æ ¡éªŒ","index":"10.3"},{"id":"10-4-restful-api-æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤","title":"10-4 RESTful API æœ€ä½³å®è·µâ€”â€”å­—æ®µè¿‡æ»¤","index":"10.4"}]},{"id":"ç¬¬11ç« -é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—","title":"ç¬¬11ç«  é¡¹ç›®å®æˆ˜ä¹‹å…³æ³¨ä¸ç²‰ä¸æ¨¡å—","index":"11","children":[{"id":"11-1-å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ","title":"11-1 å…³æ³¨ä¸ç²‰ä¸éœ€æ±‚åˆ†æ","index":"11.1"},{"id":"11-2-å…³æ³¨ä¸ç²‰ä¸çš„-schema-è®¾è®¡","title":"11-2 å…³æ³¨ä¸ç²‰ä¸çš„ schema è®¾è®¡","index":"11.2"},{"id":"11-3-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰","title":"11-3 RESTful é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸Šï¼‰","index":"11.3"},{"id":"11-4-restful-é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰","title":"11-4 RESTful é£æ ¼çš„å…³æ³¨ä¸ç²‰ä¸æ¥å£ï¼ˆä¸‹ï¼‰","index":"11.4"},{"id":"11-5-ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶","title":"11-5 ç¼–å†™æ ¡éªŒç”¨æˆ·å­˜åœ¨ä¸å¦çš„ä¸­é—´ä»¶","index":"11.5"}]},{"id":"ç¬¬12ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰","title":"ç¬¬12ç«  é¡¹ç›®å®æˆ˜ä¹‹è¯é¢˜æ¨¡å—ï¼ˆè¶³å¤Ÿå®Œæ•´ï¼ï¼ï¼‰","index":"12","children":[{"id":"12-1-è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ","title":"12-1 è¯é¢˜æ¨¡å—éœ€æ±‚åˆ†æ","index":"12.1"},{"id":"12-2-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰","title":"12-2 RESTful é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸Šï¼‰","index":"12.2"},{"id":"12-3-restful-é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰","title":"12-3 RESTful é£æ ¼çš„è¯é¢˜å¢æ”¹æŸ¥æ¥å£ï¼ˆä¸‹ï¼‰","index":"12.3"},{"id":"12-4-restful-api-æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ","title":"12-4 RESTful API æœ€ä½³å®è·µâ€”â€”åˆ†é¡µ","index":"12.4"},{"id":"12-5-restful-api-æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢","title":"12-5 RESTful API æœ€ä½³å®è·µâ€”â€”æ¨¡ç³Šæœç´¢","index":"12.5"},{"id":"12-6-ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨","title":"12-6 ç”¨æˆ·å±æ€§ä¸­çš„è¯é¢˜å¼•ç”¨","index":"12.6"},{"id":"12-7-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰","title":"12-7 RESTful é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸Šï¼‰","index":"12.7"},{"id":"12-8-restful-é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰","title":"12-8 RESTful é£æ ¼çš„å…³æ³¨è¯é¢˜æ¥å£ï¼ˆä¸‹ï¼‰","index":"12.8"}]},{"id":"ç¬¬13ç« -é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å—-â€”â€”-å¤æ‚çš„æ•°æ®åº“è®¾è®¡","title":"ç¬¬13ç«  é¡¹ç›®å®æˆ˜ä¹‹é—®é¢˜æ¨¡å— â€”â€” å¤æ‚çš„æ•°æ®åº“è®¾è®¡","index":"13","children":[{"id":"13-1-é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ","title":"13-1 é—®é¢˜æ¨¡å—éœ€æ±‚åˆ†æ","index":"13.1"},{"id":"13-2-ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°","title":"13-2 ç”¨æˆ·-é—®é¢˜ä¸€å¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°","index":"13.2"},{"id":"13-3-è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°","title":"13-3 è¯é¢˜-é—®é¢˜å¤šå¯¹å¤šå…³ç³»è®¾è®¡ä¸å®ç°","index":"13.3"}]},{"id":"ç¬¬14ç« -é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å—-â€”â€”-æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡","title":"ç¬¬14ç«  é¡¹ç›®å®æˆ˜ä¹‹ç­”æ¡ˆæ¨¡å— â€”â€” æ›´å¤æ‚çš„æ•°æ®åº“è®¾è®¡","index":"14","children":[{"id":"14-1-ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ","title":"14-1 ç­”æ¡ˆæ¨¡å—éœ€æ±‚åˆ†æ","index":"14.1"},{"id":"14-2-é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£","title":"14-2 é—®é¢˜-ç­”æ¡ˆæ¨¡å—äºŒçº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£","index":"14.2"},{"id":"14-3-äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°","title":"14-3 äº’æ–¥å…³ç³»çš„èµè¸©ç­”æ¡ˆæ¥å£è®¾è®¡ä¸å®ç°","index":"14.3"},{"id":"14-4-restful-é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£","title":"14-4 RESTful é£æ ¼çš„æ”¶è—ç­”æ¡ˆæ¥å£","index":"14.4"}]},{"id":"ç¬¬15ç« -é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å—-â€”â€”-æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡","title":"ç¬¬15ç«  é¡¹ç›®å®æˆ˜ä¹‹è¯„è®ºæ¨¡å— â€”â€” æœ€å¤æ‚çš„æ•°æ®åº“è®¾è®¡","index":"15","children":[{"id":"15-1-è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ","title":"15-1 è¯„è®ºæ¨¡å—éœ€æ±‚åˆ†æ","index":"15.1"},{"id":"15-2-é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£","title":"15-2 é—®é¢˜-ç­”æ¡ˆ-è¯„è®ºæ¨¡å—ä¸‰çº§åµŒå¥—çš„å¢åˆ æ”¹æŸ¥æ¥å£","index":"15.2"},{"id":"15-3-ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°","title":"15-3 ä¸€çº§è¯„è®ºä¸äºŒçº§è¯„è®ºæ¥å£çš„è®¾è®¡ä¸å®ç°","index":"15.3"},{"id":"15-4-æ·»åŠ æ—¥æœŸ","title":"15-4 æ·»åŠ æ—¥æœŸ","index":"15.4"}]},{"id":"ç¬¬16ç« -ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®","title":"ç¬¬16ç«  ä¸‘åª³å¦‡ç»ˆè¦è§å…¬å©†ï¼šé¡¹ç›®ä¸Šçº¿ã€éƒ¨ç½²ä¸é…ç½®","index":"16","children":[{"id":"16-1-åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git-ä¸-node.js","title":"16-1 åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Git ä¸ Node.js","index":"16.1"},{"id":"16-2-ç”¨-nginx-å®ç°ç«¯å£è½¬å‘","title":"16-2 ç”¨ Nginx å®ç°ç«¯å£è½¬å‘","index":"16.2"},{"id":"16-3-ä½¿ç”¨-pm2-ç®¡ç†è¿›ç¨‹","title":"16-3 ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹","index":"16.3"}]},{"id":"ç¬¬17ç« -ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“","title":"ç¬¬17ç«  ä½¿äººè¿›æ­¥çš„åŸºçŸ³ï¼šå›é¡¾ä¸æ€»ç»“","index":"17","children":[{"id":"17-1-å›é¡¾ä¸æ€»ç»“","title":"17-1 å›é¡¾ä¸æ€»ç»“","index":"17.1"}]}],"reward":true,"copyright":{"author":"Vincente Liang","link":"<a href=\"https://vincenteliang.com/2020/06/28/imooc_354/\" title=\"Node.jsä»¿çŸ¥ä¹æœåŠ¡ç«¯-æ·±å…¥ç†è§£RESTful API\">https://vincenteliang.com/2020/06/28/imooc_354/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"June 29, 2020","updated":"July 1, 2024"},"reading_time":"11678 words in 78 min"}