{"title":"“平安报”自动化 - win篇","date":"2020-09-20T00:00:00.000Z","date_formatted":{"ll":"Sep 20, 2020","L":"09/20/2020","MM-DD":"09-20"},"thumbnail":"https://blog-1251959181.cos.accelerate.myqcloud.com/cover/checkIn_win.jpg","link":"2020/09/19/ustb_checkIn_win","comments":true,"tags":["Note","Original Content"],"categories":["USTB"],"updated":"2024-07-01T17:57:02.538Z","content":"<div class=\"x-sign\" style='width:100%;text-align:center;'>\n    <div>人生最贵是闲暇</div>\n    <div>by 我的发小 Mr.Huyan</div>\n</div>\n<hr>\n<p><a href=\"/2020/05/14/checkIn\">上回书</a>我们说到，为了帮助同学们及时填报信息、减轻班干部与导员的工作压力，我在 Mac 上部署了一套自动化流程，每天凌晨把打卡链接发到班级群里。</p>\n<p>2020 年 9 月 5 日，返校。<br>\n2020 年 9 月 14 日，开学。宿舍恢复 11:30 断电。</p>\n<p>返校之前和刚到学校的这一星期都是 24 小时有电的，因为我的笔记本只要在充电就不会进入睡眠，所以我只需要在 24 点前把笔记本充上电放好，（只要校园网不拦着）时辰一到消息就会自动发出去。</p>\n<p><s>本校校园网十分强大，甚至可以单杀 faker</s></p>\n<p>其实十一点半断电到十二点也用不了多少电，但是每天晚上电脑拿出来就等它到时候发消息<s>就很容易忘</s>也不是那么回事。</p>\n<p>所以我决定把发消息的平台转移到实验室的台式机上，所以接下来就是 Windows 实现微信定时发消息的步骤。</p>\n<h2 id=\"序\">序<a title=\"#序\" href=\"#序\"></a></h2>\n<p>早些年通过网页版微信的接口就能实现大部分人们想要的自动化功能，不过腾讯现在已经把网页版微信收的权限收的很紧了，有的账号甚至没办法登陆微信网页版。</p>\n<p>于是就有人开发微信外挂软件（大多运行在 win 平台），这些应用被开发出来卖给公司销售/运营，甚至是黑灰产从业者，我也找了两个不过都没有运行成功。</p>\n<ul>\n<li><a href=\"https://bbs.wuaishare.cn/forum.php?mod=viewthread&amp;tid=9893&amp;fromuid=39542\" target=\"_blank\">PC 微信定时发送指定消息</a></li>\n<li><a href=\"https://bbs.wuaishare.cn/forum.php?mod=viewthread&amp;tid=2576&amp;fromuid=39542\" target=\"_blank\">Coolx 微信发卡机器人 v1.8</a></li>\n</ul>\n<p>所以还得靠仿生学（误</p>\n<p>老样子，我们把任务拆成<code>定时</code>+<code>发消息</code>两部分</p>\n<h2 id=\"发消息\">发消息<a title=\"#发消息\" href=\"#发消息\"></a></h2>\n<p>经历了漫长的网上冲浪过程之后我终于搜到了这样一篇帖子：<a href=\"https://zhuanlan.zhihu.com/p/138530198?utm_source=wechat_session\" target=\"_blank\">微信 pc 客户端自动发消息（微信聊天机器人）</a></p>\n<p>从知乎跳到 CSDN，又找到 GitHub，这里是仓库地址感兴趣的小伙伴可以去下载玩玩：<a href=\"https://github.com/p910/python/blob/master/WeChartTest1.py\" target=\"_blank\">https://github.com/p910/python/blob/master/WeChartTest1.py</a></p>\n<p>对于我这个特定的需求还需要做一些改动：</p>\n<ul>\n<li>发送消息时添加日期</li>\n<li>搜索班级群后需要点击</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 找到微信窗口，前置并放于屏幕左上角</span></span><br><span class=\"line\">    hwnd = win32gui.FindWindow(<span class=\"string\">&quot;WeChatMainWndForPC&quot;</span>, <span class=\"literal\">None</span>)</span><br><span class=\"line\">    win32gui.ShowWindow(hwnd,win32con.SW_SHOW)</span><br><span class=\"line\">    win32gui.MoveWindow(hwnd,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">1000</span>,<span class=\"number\">700</span>,<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 1.移动鼠标到通讯录位置，单击打开通讯录</span></span><br><span class=\"line\">    movePos(<span class=\"number\">28</span>,<span class=\"number\">147</span>)</span><br><span class=\"line\">    click()</span><br><span class=\"line\">    <span class=\"comment\"># 2.移动鼠标到搜索框，单击</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">    movePos(<span class=\"number\">148</span>,<span class=\"number\">35</span>)</span><br><span class=\"line\">    click()</span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 3.输入名称并单击</span></span><br><span class=\"line\">    setText(<span class=\"string\">&#x27;计算机xxxx&#x27;</span>)</span><br><span class=\"line\">    ctrlV()</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1.2</span>)</span><br><span class=\"line\">    movePos(<span class=\"number\">140</span>,<span class=\"number\">140</span>)</span><br><span class=\"line\">    click()</span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.2</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 4.生成消息并发送</span></span><br><span class=\"line\">    m = time.strftime(<span class=\"string\">&quot;%m&quot;</span>, time.localtime())</span><br><span class=\"line\">    d = time.strftime(<span class=\"string\">&quot;%d&quot;</span>, time.localtime())</span><br><span class=\"line\">    l = <span class=\"string\">&#x27;https://......&#x27;</span></span><br><span class=\"line\">    setText(m + <span class=\"string\">&#x27;月&#x27;</span> + d + <span class=\"string\">&#x27;日，来打卡啦!\\n&#x27;</span> + l)</span><br><span class=\"line\">    ctrlV()</span><br><span class=\"line\">    altS()</span><br></pre></td></tr></table></figure>\n<p>运行过程也很简单：</p>\n<ul>\n<li>打开微信并将窗口放在左上角</li>\n<li>确保你的 python 环境中装了<code>pywin32</code>这个包</li>\n<li>然后把他的 python 文件下载下来运行就好了。</li>\n</ul>\n<h2 id=\"定时\">定时<a title=\"#定时\" href=\"#定时\"></a></h2>\n<p>windows 上的定时就很简单了，不需要命令行/代码。</p>\n<p>在开始菜单按钮上右键选择计算机管理，添加计划任务，启动程序，<a href=\"http://xn--ceto4d98exxzgf3a.py\">选择对应的.py</a> 文件。</p>\n<p>这个教程网上很多很多了，我就不再赘述了。</p>\n<h2 id=\"参考资料\">参考资料<a title=\"#参考资料\" href=\"#参考资料\"></a></h2>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_27399/article/details/105767682\" target=\"_blank\">python 操作微信自动发消息（微信聊天机器人）</a></li>\n</ul>\n","prev":{"title":"北科大经济与管理整理2021版","link":"2020/12/31/ustb_economy&management"},"next":{"title":"Node.js仿知乎服务端-深入理解RESTful API","link":"2020/06/28/imooc_354"},"plink":"https://vincenteliang.com/2020/09/19/ustb_checkIn_win/","toc":[{"id":"序","title":"序","index":"1"},{"id":"发消息","title":"发消息","index":"2"},{"id":"定时","title":"定时","index":"3"},{"id":"参考资料","title":"参考资料","index":"4"}],"reward":true,"copyright":{"author":"Vincente Liang","link":"<a href=\"https://vincenteliang.com/2020/09/19/ustb_checkIn_win/\" title=\"“平安报”自动化 - win篇\">https://vincenteliang.com/2020/09/19/ustb_checkIn_win/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"September 20, 2020","updated":"July 1, 2024"},"reading_time":"911 words in 6 min"}